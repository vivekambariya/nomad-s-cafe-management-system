<html>
<head>
<title>nomadscafe.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
nomadscafe.java</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datastructures</span><span class="s2">.</span><span class="s1">DataStructures</span><span class="s2">;</span>

<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">sql</span><span class="s2">.*;</span>
<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">sql</span><span class="s2">.</span><span class="s1">Date</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">time</span><span class="s2">.*;</span>
<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">time</span><span class="s2">.</span><span class="s1">format</span><span class="s2">.*;</span>
<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.*;</span>
<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">io</span><span class="s2">.*;</span>
<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">stream</span><span class="s2">.</span><span class="s1">Collectors</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">javax</span><span class="s2">.</span><span class="s1">mail</span><span class="s2">.*;</span>
<span class="s0">import </span><span class="s1">javax</span><span class="s2">.</span><span class="s1">mail</span><span class="s2">.</span><span class="s1">internet</span><span class="s2">.*;</span>

<span class="s0">class </span><span class="s1">Order </span><span class="s2">{</span>
    <span class="s0">int </span><span class="s1">orderId</span><span class="s2">;</span>
    <span class="s0">int </span><span class="s1">itemId</span><span class="s2">;</span>
    <span class="s0">int </span><span class="s1">quantity</span><span class="s2">;</span>
    <span class="s1">String username</span><span class="s2">;</span>
    <span class="s1">LocalDateTime timestamp</span><span class="s2">;</span>
    <span class="s1">String status</span><span class="s2">;</span>

    <span class="s0">public </span><span class="s1">Order</span><span class="s2">(</span><span class="s0">int </span><span class="s1">itemId</span><span class="s2">, </span><span class="s0">int </span><span class="s1">quantity</span><span class="s2">, </span><span class="s1">String username</span><span class="s2">) {</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">itemId </span><span class="s2">= </span><span class="s1">itemId</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">quantity </span><span class="s2">= </span><span class="s1">quantity</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">username </span><span class="s2">= </span><span class="s1">username</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">timestamp </span><span class="s2">= </span><span class="s1">LocalDateTime</span><span class="s2">.</span><span class="s1">now</span><span class="s2">();</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">status </span><span class="s2">= </span><span class="s3">&quot;PENDING&quot;</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">@Override</span>
    <span class="s0">public </span><span class="s1">String toString</span><span class="s2">() {</span>
        <span class="s0">return </span><span class="s3">&quot;OrderID: &quot; </span><span class="s2">+ </span><span class="s1">orderId </span><span class="s2">+</span>
                <span class="s3">&quot; | User: &quot; </span><span class="s2">+ </span><span class="s1">username </span><span class="s2">+</span>
                <span class="s3">&quot; | ItemID: &quot; </span><span class="s2">+ </span><span class="s1">itemId </span><span class="s2">+</span>
                <span class="s3">&quot; | Qty: &quot; </span><span class="s2">+ </span><span class="s1">quantity </span><span class="s2">+</span>
                <span class="s3">&quot; | Time: &quot; </span><span class="s2">+ </span><span class="s1">timestamp</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">DateTimeFormatter</span><span class="s2">.</span><span class="s1">ofPattern</span><span class="s2">(</span><span class="s3">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="s2">)) +</span>
                <span class="s3">&quot; | Status: &quot; </span><span class="s2">+ </span><span class="s1">status</span><span class="s2">;</span>
    <span class="s2">}</span>
<span class="s2">}</span>
<span class="s0">class </span><span class="s1">MenuItem </span><span class="s2">{</span>
    <span class="s0">int </span><span class="s1">id</span><span class="s2">;</span>
    <span class="s1">String name</span><span class="s2">;</span>
    <span class="s1">String category</span><span class="s2">;</span>
    <span class="s0">double </span><span class="s1">price</span><span class="s2">;</span>
    <span class="s0">boolean </span><span class="s1">availability</span><span class="s2">;</span>
    <span class="s0">int </span><span class="s1">popularity</span><span class="s2">;</span>

    <span class="s0">public </span><span class="s1">MenuItem</span><span class="s2">(</span><span class="s0">int </span><span class="s1">id</span><span class="s2">, </span><span class="s1">String name</span><span class="s2">, </span><span class="s1">String category</span><span class="s2">, </span><span class="s0">double </span><span class="s1">price</span><span class="s2">, </span><span class="s0">boolean </span><span class="s1">availability</span><span class="s2">) {</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">id </span><span class="s2">= </span><span class="s1">id</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">name</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">category </span><span class="s2">= </span><span class="s1">category</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">price </span><span class="s2">= </span><span class="s1">price</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">availability </span><span class="s2">= </span><span class="s1">availability</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">popularity </span><span class="s2">= </span><span class="s4">0</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">@Override</span>

    <span class="s0">public </span><span class="s1">String toString</span><span class="s2">() {</span>
        <span class="s0">int </span><span class="s1">availInt </span><span class="s2">= </span><span class="s1">availability </span><span class="s2">? </span><span class="s4">1 </span><span class="s2">: </span><span class="s4">0</span><span class="s2">;  </span><span class="s5">// Convert boolean to 1 or 0</span>
        <span class="s0">return </span><span class="s1">String</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">&quot;ID: %d | Name: %-20s | Category: %-15s | Price: %6.2f | availability: %d | Popularity: %d&quot;</span><span class="s2">,</span>
                <span class="s1">id</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">price</span><span class="s2">, </span><span class="s1">availInt</span><span class="s2">, </span><span class="s1">popularity</span><span class="s2">);</span>
    <span class="s2">}</span>

<span class="s2">}</span>
<span class="s0">class </span><span class="s1">SpecialOffer </span><span class="s2">{</span>
    <span class="s1">String type</span><span class="s2">; </span><span class="s5">// &quot;HAPPY_HOUR&quot;, &quot;CATEGORY&quot;</span>
    <span class="s0">int </span><span class="s1">discountPercent</span><span class="s2">;</span>
    <span class="s0">boolean </span><span class="s1">isActive </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s0">class </span><span class="s1">HappyHourOffer </span><span class="s0">extends </span><span class="s1">SpecialOffer </span><span class="s2">{</span>
    <span class="s1">LocalTime startTime</span><span class="s2">;</span>
    <span class="s1">LocalTime endTime</span><span class="s2">;</span>
    <span class="s1">DataStructures</span><span class="s2">.</span><span class="s1">CustomHashSet</span><span class="s2">&lt;</span><span class="s1">DayOfWeek</span><span class="s2">&gt; </span><span class="s1">days</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s0">class </span><span class="s1">CategoryOffer </span><span class="s0">extends </span><span class="s1">SpecialOffer </span><span class="s2">{</span>
    <span class="s1">String category</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s0">class </span><span class="s1">Cafe2 </span><span class="s2">{</span>
    <span class="s0">static </span><span class="s1">Connection con</span><span class="s2">;</span>
    <span class="s0">static </span><span class="s1">Statement st</span><span class="s2">;</span>
    <span class="s0">static </span><span class="s1">DataStructures</span><span class="s2">.</span><span class="s1">CustomLinkedList</span><span class="s2">&lt;</span><span class="s1">Order</span><span class="s2">&gt; </span><span class="s1">orderQueue </span><span class="s2">= </span><span class="s0">new </span><span class="s1">DataStructures</span><span class="s2">.</span><span class="s1">CustomLinkedList</span><span class="s2">&lt;&gt;();</span>
    <span class="s0">static </span><span class="s1">Scanner scanner </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Scanner</span><span class="s2">(</span><span class="s1">System</span><span class="s2">.</span><span class="s1">in</span><span class="s2">);</span>
    <span class="s0">static </span><span class="s1">DataStructures</span><span class="s2">.</span><span class="s1">CustomHashMap</span><span class="s2">&lt;</span><span class="s1">Integer</span><span class="s2">, </span><span class="s1">MenuItem</span><span class="s2">&gt; </span><span class="s1">menuMap </span><span class="s2">= </span><span class="s0">new </span><span class="s1">DataStructures</span><span class="s2">.</span><span class="s1">CustomHashMap</span><span class="s2">&lt;&gt;();</span>
    <span class="s0">static final </span><span class="s1">DateTimeFormatter DATE_FORMATTER </span><span class="s2">= </span><span class="s1">DateTimeFormatter</span><span class="s2">.</span><span class="s1">ofPattern</span><span class="s2">(</span><span class="s3">&quot;yyyy-MM-dd&quot;</span><span class="s2">);</span>
    <span class="s0">static final </span><span class="s1">String MANAGER_PASSWORD </span><span class="s2">= </span><span class="s3">&quot;Cafe@123&quot;</span><span class="s2">;</span>

    <span class="s5">// Email configuration</span>
    <span class="s0">private static final </span><span class="s1">String SMTP_HOST </span><span class="s2">= </span><span class="s3">&quot;smtp.gmail.com&quot;</span><span class="s2">;</span>
    <span class="s0">private static final </span><span class="s1">String SMTP_PORT </span><span class="s2">= </span><span class="s3">&quot;587&quot;</span><span class="s2">;</span>
    <span class="s0">private static final </span><span class="s1">String EMAIL_USERNAME </span><span class="s2">= </span><span class="s3">&quot;nomadscafe247@gmail.com&quot;</span><span class="s2">;</span>
    <span class="s0">private static final </span><span class="s1">String EMAIL_PASSWORD </span><span class="s2">= </span><span class="s3">&quot;ktiz jyym lndg gacf&quot;</span><span class="s2">;</span>
    <span class="s0">private static final boolean </span><span class="s1">USE_SSL </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>


    <span class="s0">static </span><span class="s1">List</span><span class="s2">&lt;</span><span class="s1">HappyHourOffer</span><span class="s2">&gt; </span><span class="s1">happyHourOffers </span><span class="s2">= </span><span class="s0">new </span><span class="s1">ArrayList</span><span class="s2">&lt;&gt;();</span>
    <span class="s0">static </span><span class="s1">List</span><span class="s2">&lt;</span><span class="s1">CategoryOffer</span><span class="s2">&gt; </span><span class="s1">categoryOffers </span><span class="s2">= </span><span class="s0">new </span><span class="s1">ArrayList</span><span class="s2">&lt;&gt;();</span>


    <span class="s0">public static void </span><span class="s1">main</span><span class="s2">(</span><span class="s1">String</span><span class="s2">[] </span><span class="s1">args</span><span class="s2">) {</span>
        <span class="s0">try </span><span class="s2">{</span>
            <span class="s1">String url </span><span class="s2">= </span><span class="s3">&quot;jdbc:mysql://localhost:3306/vivek&quot;</span><span class="s2">;</span>
            <span class="s1">String user </span><span class="s2">= </span><span class="s3">&quot;root&quot;</span><span class="s2">;</span>
            <span class="s1">String password </span><span class="s2">= </span><span class="s3">&quot;&quot;</span><span class="s2">;</span>

            <span class="s1">con </span><span class="s2">= </span><span class="s1">DriverManager</span><span class="s2">.</span><span class="s1">getConnection</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">user</span><span class="s2">, </span><span class="s1">password</span><span class="s2">);</span>
            <span class="s1">st </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">createStatement</span><span class="s2">();</span>
            <span class="s1">con</span><span class="s2">.</span><span class="s1">setAutoCommit</span><span class="s2">(</span><span class="s0">false</span><span class="s2">);</span>
            <span class="s1">initializeDatabase</span><span class="s2">();</span>
            <span class="s1">loadMenuItems</span><span class="s2">();</span>

            <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">===== Cafe Management System =====&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;1. Manager Mode&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;2. User Mode&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;3. Customer Loyalty Program&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;4. View Popular Items&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;5. Exit&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter choice: &quot;</span><span class="s2">);</span>

                <span class="s0">int </span><span class="s1">choice</span><span class="s2">;</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s1">choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                        <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">choice </span><span class="s2">&gt;= </span><span class="s4">1 </span><span class="s2">&amp;&amp; </span><span class="s1">choice </span><span class="s2">&lt;= </span><span class="s4">5</span><span class="s2">) {</span>
                            <span class="s0">break</span><span class="s2">;</span>
                        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter a number between 1 and 5: &quot;</span><span class="s2">);</span>
                        <span class="s2">}</span>
                    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a number between 1 and 5: &quot;</span><span class="s2">);</span>
                        <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s0">switch </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">) {</span>
                    <span class="s0">case </span><span class="s4">1</span><span class="s2">:</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">authenticateManager</span><span class="s2">())</span>
                            <span class="s1">managerMode</span><span class="s2">();</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s0">case </span><span class="s4">2</span><span class="s2">:</span>
                        <span class="s1">userMode</span><span class="s2">();</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s0">case </span><span class="s4">3</span><span class="s2">:</span>
                        <span class="s1">loyaltyProgram</span><span class="s2">();</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s0">case </span><span class="s4">4</span><span class="s2">:</span>
                        <span class="s1">viewPopularItems</span><span class="s2">();</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s0">case </span><span class="s4">5</span><span class="s2">:</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Exiting system...&quot;</span><span class="s2">);</span>
                        <span class="s0">return</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">Exception e</span><span class="s2">) {</span>
            <span class="s1">e</span><span class="s2">.</span><span class="s1">printStackTrace</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s0">finally </span><span class="s2">{</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">con </span><span class="s2">!= </span><span class="s0">null</span><span class="s2">) </span><span class="s1">con</span><span class="s2">.</span><span class="s1">close</span><span class="s2">();</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">st </span><span class="s2">!= </span><span class="s0">null</span><span class="s2">) </span><span class="s1">st</span><span class="s2">.</span><span class="s1">close</span><span class="s2">();</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">scanner </span><span class="s2">!= </span><span class="s0">null</span><span class="s2">) </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">close</span><span class="s2">();</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">SQLException e</span><span class="s2">) {</span>
                <span class="s1">e</span><span class="s2">.</span><span class="s1">printStackTrace</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static boolean </span><span class="s1">authenticateManager</span><span class="s2">() {</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter Manager Password: &quot;</span><span class="s2">);</span>
        <span class="s1">String inputPassword </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">inputPassword</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">MANAGER_PASSWORD</span><span class="s2">)) {</span>
            <span class="s0">return true</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Incorrect password! Access denied.&quot;</span><span class="s2">);</span>
            <span class="s0">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">initializeDatabase</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String createMenuTable </span><span class="s2">= </span><span class="s3">&quot;CREATE TABLE IF NOT EXISTS menu_items (&quot; </span><span class="s2">+</span>
                <span class="s3">&quot;ID INT PRIMARY KEY AUTO_INCREMENT, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Name VARCHAR(100), &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Category VARCHAR(100), &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Price DOUBLE, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;availability BOOLEAN, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Popularity INT DEFAULT 0)&quot;</span><span class="s2">;</span>
        <span class="s1">st</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">(</span><span class="s1">createMenuTable</span><span class="s2">);</span>

        <span class="s1">String createOrdersTable </span><span class="s2">= </span><span class="s3">&quot;CREATE TABLE IF NOT EXISTS orders (&quot; </span><span class="s2">+</span>
                <span class="s3">&quot;OrderID INT PRIMARY KEY AUTO_INCREMENT, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;ItemID INT, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Quantity INT, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Username VARCHAR(100), &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;OrderTime DATETIME, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Status VARCHAR(50))&quot;</span><span class="s2">;</span>
        <span class="s1">st</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">(</span><span class="s1">createOrdersTable</span><span class="s2">);</span>

        <span class="s1">String createLoyaltyTable </span><span class="s2">= </span><span class="s3">&quot;CREATE TABLE IF NOT EXISTS loyalty_program (&quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Username VARCHAR(100) PRIMARY KEY, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Points INT DEFAULT 0, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;LastVisit DATE)&quot;</span><span class="s2">;</span>
        <span class="s1">st</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">(</span><span class="s1">createLoyaltyTable</span><span class="s2">);</span>

        <span class="s1">String createUserTable </span><span class="s2">= </span><span class="s3">&quot;CREATE TABLE IF NOT EXISTS users (&quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Username VARCHAR(100) PRIMARY KEY, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Email VARCHAR(100) UNIQUE, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;Verified BOOLEAN DEFAULT false, &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;LastLogin TIMESTAMP)&quot;</span><span class="s2">;</span>
        <span class="s1">st</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">(</span><span class="s1">createUserTable</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">userMode</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">Scanner scanner </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Scanner</span><span class="s2">(</span><span class="s1">System</span><span class="s2">.</span><span class="s1">in</span><span class="s2">);</span>

        <span class="s5">// Get username</span>
        <span class="s1">String username</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter your name: &quot;</span><span class="s2">);</span>
            <span class="s1">username </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">();</span>
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">username</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Name cannot be empty. Please try again.&quot;</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s5">// Get email - simple validation</span>
        <span class="s1">String email</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter your email: &quot;</span><span class="s2">);</span>
            <span class="s1">email </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">();</span>

            <span class="s5">// Basic email validation</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">email</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span><span class="s3">&quot;@&quot;</span><span class="s2">) &amp;&amp; </span><span class="s1">email</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span><span class="s3">&quot;.&quot;</span><span class="s2">) &amp;&amp; </span><span class="s1">email</span><span class="s2">.</span><span class="s1">length</span><span class="s2">() &gt; </span><span class="s4">5</span><span class="s2">) {</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Please enter a valid email (must contain @ and .)&quot;</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s5">// Check if user exists</span>
        <span class="s1">String checkUserSql </span><span class="s2">= </span><span class="s3">&quot;SELECT Verified FROM users WHERE Username = ? OR Email = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">checkUserSql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">email</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s5">// Existing user</span>
                <span class="s0">boolean </span><span class="s1">verified </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getBoolean</span><span class="s2">(</span><span class="s3">&quot;Verified&quot;</span><span class="s2">);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">verified</span><span class="s2">) {</span>
                    <span class="s5">// Welcome back existing verified user</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">====================================&quot;</span><span class="s2">);</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;   Welcome back, &quot; </span><span class="s2">+ </span><span class="s1">username </span><span class="s2">+ </span><span class="s3">&quot;!&quot;</span><span class="s2">);</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;====================================&quot;</span><span class="s2">);</span>
                    <span class="s1">updateLoyaltyPoints</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s4">2</span><span class="s2">); </span><span class="s5">// Add welcome back points</span>
                    <span class="s1">userModeMenu</span><span class="s2">(</span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s0">return</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                    <span class="s5">// Existing but unverified user</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Account not verified. Please verify your email.&quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                <span class="s5">// New user - create account</span>
                <span class="s1">String insertSql </span><span class="s2">= </span><span class="s3">&quot;INSERT INTO users (Username, Email, Verified) VALUES (?, ?, false)&quot;</span><span class="s2">;</span>
                <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement insertPs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">insertSql</span><span class="s2">)) {</span>
                    <span class="s1">insertPs</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s1">insertPs</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">email</span><span class="s2">);</span>
                    <span class="s1">insertPs</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
                <span class="s2">}</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;New account created. Please verify your email.&quot;</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s5">// OTP verification for new/unverified users</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">verifyEmailWithOTP</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s1">email</span><span class="s2">)) {</span>
                <span class="s5">// Successful verification</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">====================================&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;   Welcome to Nomad's Cafe, &quot; </span><span class="s2">+ </span><span class="s1">username </span><span class="s2">+ </span><span class="s3">&quot;!&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;====================================&quot;</span><span class="s2">);</span>
                <span class="s1">updateLoyaltyPoints</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s4">5</span><span class="s2">); </span><span class="s5">// Add welcome points for new users</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Would you like to try again? (yes/no)&quot;</span><span class="s2">);</span>
            <span class="s1">String choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">choice</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;yes&quot;</span><span class="s2">)) {</span>
                <span class="s0">return</span><span class="s2">; </span><span class="s5">// Exit if user doesn't want to try again</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">userModeMenu</span><span class="s2">(</span><span class="s1">username</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">userModeMenu</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">updateLoyaltyPoints</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s4">5</span><span class="s2">); </span><span class="s5">// Welcome points</span>

        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- USER MODE: Welcome &quot; </span><span class="s2">+ </span><span class="s1">username </span><span class="s2">+ </span><span class="s3">&quot; ---&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;1. View Menu&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;2. Place Order&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;3. View Order Status&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;4. View Loyalty Points&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;5. View Current Offers&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;6. Back to Main Menu&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Choice: &quot;</span><span class="s2">);</span>

            <span class="s0">int </span><span class="s1">choice</span><span class="s2">;</span>
            <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                <span class="s0">try </span><span class="s2">{</span>
                    <span class="s1">choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">choice </span><span class="s2">&gt;= </span><span class="s4">1 </span><span class="s2">&amp;&amp; </span><span class="s1">choice </span><span class="s2">&lt;= </span><span class="s4">6</span><span class="s2">) {</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter a number between 1 and 6: &quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a number between 1 and 6: &quot;</span><span class="s2">);</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s0">switch </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">) {</span>
                <span class="s0">case </span><span class="s4">1</span><span class="s2">:</span>
                    <span class="s1">displayMenu</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">2</span><span class="s2">:</span>
                    <span class="s1">placeOrder</span><span class="s2">(</span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">3</span><span class="s2">:</span>
                    <span class="s1">viewOrderStatus</span><span class="s2">(</span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">4</span><span class="s2">:</span>
                    <span class="s1">viewLoyaltyPoints</span><span class="s2">(</span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">5</span><span class="s2">:</span>
                    <span class="s1">viewCurrentOffers</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">6</span><span class="s2">:</span>
                    <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static boolean </span><span class="s1">verifyEmailWithOTP</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">, </span><span class="s1">String email</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String otp </span><span class="s2">= </span><span class="s1">generateOTP</span><span class="s2">();</span>

        <span class="s0">try </span><span class="s2">{</span>
            <span class="s1">sendOTPEmail</span><span class="s2">(</span><span class="s1">email</span><span class="s2">, </span><span class="s1">otp</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;OTP sent to &quot; </span><span class="s2">+ </span><span class="s1">email</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">Exception e</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Failed to send OTP: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getMessage</span><span class="s2">());</span>
            <span class="s0">return false</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter the OTP sent to your email: &quot;</span><span class="s2">);</span>
        <span class="s1">String userOTP </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>

        <span class="s0">if </span><span class="s2">(</span><span class="s1">userOTP</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">otp</span><span class="s2">)) {</span>
            <span class="s5">// Update user as verified in database</span>
            <span class="s1">String updateSql </span><span class="s2">= </span><span class="s3">&quot;UPDATE users SET Verified = true WHERE Username = ?&quot;</span><span class="s2">;</span>
            <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">updateSql</span><span class="s2">)) {</span>
                <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
                <span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Email verified successfully!&quot;</span><span class="s2">);</span>
            <span class="s0">return true</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid OTP.&quot;</span><span class="s2">);</span>
            <span class="s0">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static </span><span class="s1">String generateOTP</span><span class="s2">() {</span>
        <span class="s1">Random random </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Random</span><span class="s2">();</span>
        <span class="s0">return </span><span class="s1">String</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">&quot;%06d&quot;</span><span class="s2">, </span><span class="s1">random</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">(</span><span class="s4">999999</span><span class="s2">));</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">sendOTPEmail</span><span class="s2">(</span><span class="s1">String recipientEmail</span><span class="s2">, </span><span class="s1">String otp</span><span class="s2">) {</span>
        <span class="s1">Properties props </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Properties</span><span class="s2">();</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.auth&quot;</span><span class="s2">, </span><span class="s3">&quot;true&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.starttls.enable&quot;</span><span class="s2">, </span><span class="s3">&quot;true&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.host&quot;</span><span class="s2">, </span><span class="s3">&quot;smtp.gmail.com&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.port&quot;</span><span class="s2">, </span><span class="s3">&quot;587&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.ssl.protocols&quot;</span><span class="s2">, </span><span class="s3">&quot;TLSv1.2&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.connectiontimeout&quot;</span><span class="s2">, </span><span class="s3">&quot;10000&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.timeout&quot;</span><span class="s2">, </span><span class="s3">&quot;10000&quot;</span><span class="s2">);</span>


        <span class="s1">Session session </span><span class="s2">= </span><span class="s1">Session</span><span class="s2">.</span><span class="s1">getInstance</span><span class="s2">(</span><span class="s1">props</span><span class="s2">, </span><span class="s0">new </span><span class="s1">Authenticator</span><span class="s2">() {</span>
            <span class="s0">protected </span><span class="s1">PasswordAuthentication getPasswordAuthentication</span><span class="s2">() {</span>
                <span class="s0">return new </span><span class="s1">PasswordAuthentication</span><span class="s2">(</span><span class="s1">EMAIL_USERNAME</span><span class="s2">, </span><span class="s1">EMAIL_PASSWORD</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">});</span>


        <span class="s0">try </span><span class="s2">{</span>
            <span class="s1">Message message </span><span class="s2">= </span><span class="s0">new </span><span class="s1">MimeMessage</span><span class="s2">(</span><span class="s1">session</span><span class="s2">);</span>
            <span class="s1">message</span><span class="s2">.</span><span class="s1">setFrom</span><span class="s2">(</span><span class="s0">new </span><span class="s1">InternetAddress</span><span class="s2">(</span><span class="s1">EMAIL_USERNAME</span><span class="s2">));</span>
            <span class="s1">message</span><span class="s2">.</span><span class="s1">setRecipients</span><span class="s2">(</span><span class="s1">Message</span><span class="s2">.</span><span class="s1">RecipientType</span><span class="s2">.</span><span class="s1">TO</span><span class="s2">, </span><span class="s1">InternetAddress</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">recipientEmail</span><span class="s2">));</span>
            <span class="s1">message</span><span class="s2">.</span><span class="s1">setSubject</span><span class="s2">(</span><span class="s3">&quot;Your OTP Code&quot;</span><span class="s2">);</span>

            <span class="s1">message</span><span class="s2">.</span><span class="s1">setText</span><span class="s2">(</span><span class="s3">&quot; HEY CUSTOMER...!! WELCOME TO THE NOMADS'S CAFE.&quot; </span><span class="s2">+</span>
                    <span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Your verification code is: &quot; </span><span class="s2">+ </span><span class="s1">otp</span><span class="s2">);</span>

            <span class="s1">Transport</span><span class="s2">.</span><span class="s1">send</span><span class="s2">(</span><span class="s1">message</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Email sent successfully!&quot;</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">AuthenticationFailedException e</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">err</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Authentication failed. Check your email credentials.&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">err</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Did you enable 'Less secure apps' or create an App Password?&quot;</span><span class="s2">);</span>
            <span class="s1">e</span><span class="s2">.</span><span class="s1">printStackTrace</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">MessagingException e</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">err</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Email sending failed. Full error details:&quot;</span><span class="s2">);</span>
            <span class="s1">e</span><span class="s2">.</span><span class="s1">printStackTrace</span><span class="s2">();</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">sendOrderConfirmationEmail</span><span class="s2">(</span><span class="s1">String recipientEmail</span><span class="s2">, </span><span class="s1">String username</span><span class="s2">,</span>
                                           <span class="s1">String itemName</span><span class="s2">, </span><span class="s0">int </span><span class="s1">quantity</span><span class="s2">,</span>
                                           <span class="s0">double </span><span class="s1">basePrice</span><span class="s2">, </span><span class="s0">double </span><span class="s1">totalDiscount</span><span class="s2">,</span>
                                           <span class="s0">double </span><span class="s1">finalPrice</span><span class="s2">, </span><span class="s1">List</span><span class="s2">&lt;</span><span class="s1">String</span><span class="s2">&gt; </span><span class="s1">freeItems</span><span class="s2">) {</span>
        <span class="s1">Properties props </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Properties</span><span class="s2">();</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.auth&quot;</span><span class="s2">, </span><span class="s3">&quot;true&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.starttls.enable&quot;</span><span class="s2">, </span><span class="s3">&quot;true&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.host&quot;</span><span class="s2">, </span><span class="s3">&quot;smtp.gmail.com&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.port&quot;</span><span class="s2">, </span><span class="s3">&quot;587&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.ssl.protocols&quot;</span><span class="s2">, </span><span class="s3">&quot;TLSv1.2&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.connectiontimeout&quot;</span><span class="s2">, </span><span class="s3">&quot;10000&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.timeout&quot;</span><span class="s2">, </span><span class="s3">&quot;10000&quot;</span><span class="s2">);</span>
        <span class="s1">props</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s3">&quot;mail.smtp.writetimeout&quot;</span><span class="s2">, </span><span class="s3">&quot;10000&quot;</span><span class="s2">);</span>

        <span class="s1">Session session </span><span class="s2">= </span><span class="s1">Session</span><span class="s2">.</span><span class="s1">getInstance</span><span class="s2">(</span><span class="s1">props</span><span class="s2">, </span><span class="s0">new </span><span class="s1">Authenticator</span><span class="s2">() {</span>
            <span class="s0">protected </span><span class="s1">PasswordAuthentication getPasswordAuthentication</span><span class="s2">() {</span>
                <span class="s0">return new </span><span class="s1">PasswordAuthentication</span><span class="s2">(</span><span class="s1">EMAIL_USERNAME</span><span class="s2">, </span><span class="s1">EMAIL_PASSWORD</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">});</span>
        <span class="s0">try </span><span class="s2">{</span>

            <span class="s1">Message message </span><span class="s2">= </span><span class="s0">new </span><span class="s1">MimeMessage</span><span class="s2">(</span><span class="s1">session</span><span class="s2">);</span>
            <span class="s1">message</span><span class="s2">.</span><span class="s1">setFrom</span><span class="s2">(</span><span class="s0">new </span><span class="s1">InternetAddress</span><span class="s2">(</span><span class="s1">EMAIL_USERNAME</span><span class="s2">));</span>
            <span class="s1">message</span><span class="s2">.</span><span class="s1">setRecipients</span><span class="s2">(</span><span class="s1">Message</span><span class="s2">.</span><span class="s1">RecipientType</span><span class="s2">.</span><span class="s1">TO</span><span class="s2">, </span><span class="s1">InternetAddress</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">recipientEmail</span><span class="s2">));</span>
            <span class="s1">message</span><span class="s2">.</span><span class="s1">setSubject</span><span class="s2">(</span><span class="s3">&quot;Your Order at Nomad's Cafe&quot;</span><span class="s2">);</span>

            <span class="s5">// Build the email content with proper discount information</span>
            <span class="s1">StringBuilder emailContent </span><span class="s2">= </span><span class="s0">new </span><span class="s1">StringBuilder</span><span class="s2">();</span>
            <span class="s1">emailContent</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Dear &quot;</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">username</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;,</span><span class="s0">\n\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Thank you for your order at Nomad's Cafe!</span><span class="s0">\n\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Order Details:</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">);</span>

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">itemName</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
                <span class="s1">emailContent</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Item: &quot;</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">itemName</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                        <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Quantity: &quot;</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">quantity</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                        <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Base Price: Rs.&quot;</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">String</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">&quot;%.2f&quot;</span><span class="s2">, </span><span class="s1">basePrice</span><span class="s2">)).</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">);</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">totalDiscount </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">) {</span>
                    <span class="s1">emailContent</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Total Discount: Rs.&quot;</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">String</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">&quot;%.2f&quot;</span><span class="s2">, </span><span class="s1">totalDiscount</span><span class="s2">)).</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                            <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Discount Percentage: &quot;</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">String</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">&quot;%.1f%%&quot;</span><span class="s2">, (</span><span class="s1">totalDiscount</span><span class="s2">/</span><span class="s1">basePrice</span><span class="s2">)*</span><span class="s4">100</span><span class="s2">)).</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">freeItems</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
                <span class="s1">emailContent</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Free Items Included:</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">);</span>
                <span class="s0">for </span><span class="s2">(</span><span class="s1">String freeItem </span><span class="s2">: </span><span class="s1">freeItems</span><span class="s2">) {</span>
                    <span class="s1">emailContent</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;- &quot;</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">freeItem</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s1">emailContent</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Final Amount: Rs.&quot;</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">String</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">&quot;%.2f&quot;</span><span class="s2">, </span><span class="s1">finalPrice</span><span class="s2">)).</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Your order is being prepared with love by our team.</span><span class="s0">\n\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Greetings from all of us at Nomad's Cafe!</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;We appreciate your business and look forward to serving you again soon.</span><span class="s0">\n\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Warm regards,</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;The Nomad's Cafe Team</span><span class="s0">\n\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;Did you know? You can earn loyalty points with every purchase....!</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">YEAH YOU HEARD IT TRUE...GO AND CHECK IT OUT&quot;</span><span class="s2">);</span>

            <span class="s1">message</span><span class="s2">.</span><span class="s1">setText</span><span class="s2">(</span><span class="s1">emailContent</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">());</span>
            <span class="s1">Transport</span><span class="s2">.</span><span class="s1">send</span><span class="s2">(</span><span class="s1">message</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Order confirmation email sent to &quot; </span><span class="s2">+ </span><span class="s1">recipientEmail</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">Exception e</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Failed to send order confirmation email: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getMessage</span><span class="s2">());</span>
            <span class="s1">e</span><span class="s2">.</span><span class="s1">printStackTrace</span><span class="s2">();</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">displayMenu</span><span class="s2">() {</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- MENU (sorted by category) ---&quot;</span><span class="s2">);</span>
        <span class="s1">menuMap</span><span class="s2">.</span><span class="s1">values</span><span class="s2">().</span><span class="s1">stream</span><span class="s2">()</span>
                <span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">item -&gt; item</span><span class="s2">.</span><span class="s1">availability</span><span class="s2">)</span>
                <span class="s2">.</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">Comparator</span><span class="s2">.</span><span class="s1">comparing</span><span class="s2">((</span><span class="s1">MenuItem item</span><span class="s2">) </span><span class="s1">-&gt; item</span><span class="s2">.</span><span class="s1">category</span><span class="s2">)</span>
                        <span class="s2">.</span><span class="s1">thenComparing</span><span class="s2">(</span><span class="s1">item -&gt; item</span><span class="s2">.</span><span class="s1">name</span><span class="s2">))</span>
                <span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s1">System</span><span class="s2">.</span><span class="s1">out::println</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">placeOrder</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">displayMenu</span><span class="s2">();</span>

        <span class="s5">// Check for free items from loyalty program</span>
        <span class="s0">boolean </span><span class="s1">hasFreeCoffee </span><span class="s2">= </span><span class="s1">checkForFreeCoffee</span><span class="s2">(</span><span class="s1">username</span><span class="s2">);</span>
        <span class="s0">boolean </span><span class="s1">hasFreeMeal </span><span class="s2">= </span><span class="s1">checkForFreeMeal</span><span class="s2">(</span><span class="s1">username</span><span class="s2">);</span>

        <span class="s5">// Regular order</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter Item ID to order (or 0 if only claiming free item): &quot;</span><span class="s2">);</span>
        <span class="s0">int </span><span class="s1">itemId</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">itemId </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">itemId </span><span class="s2">== </span><span class="s4">0 </span><span class="s2">|| </span><span class="s1">menuMap</span><span class="s2">.</span><span class="s1">containsKey</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">)) {</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid Item ID! Please enter a valid ID: &quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input! Please enter a numeric ID: &quot;</span><span class="s2">);</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">int </span><span class="s1">quantity </span><span class="s2">= </span><span class="s4">0</span><span class="s2">;</span>
        <span class="s1">MenuItem item </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
        <span class="s0">double </span><span class="s1">orderValue </span><span class="s2">= </span><span class="s4">0</span><span class="s2">;</span>
        <span class="s0">int </span><span class="s1">pointsEarned </span><span class="s2">= </span><span class="s4">0</span><span class="s2">; </span><span class="s5">// Declare pointsEarned here</span>

        <span class="s0">if </span><span class="s2">(</span><span class="s1">itemId </span><span class="s2">!= </span><span class="s4">0</span><span class="s2">) {</span>
            <span class="s1">item </span><span class="s2">= </span><span class="s1">menuMap</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">);</span>
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">item</span><span class="s2">.</span><span class="s1">availability</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;This item is currently unavailable!&quot;</span><span class="s2">);</span>
                <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter Quantity: &quot;</span><span class="s2">);</span>
            <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                <span class="s0">try </span><span class="s2">{</span>
                    <span class="s1">quantity </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">quantity </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">) {</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Quantity must be positive. Please enter again: &quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input! Please enter a positive number: &quot;</span><span class="s2">);</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
            <span class="s1">orderValue </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">price </span><span class="s2">* </span><span class="s1">quantity</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s5">// Calculate the bill with discounts</span>
        <span class="s0">double </span><span class="s1">basePrice </span><span class="s2">= </span><span class="s1">orderValue</span><span class="s2">;</span>
        <span class="s0">double </span><span class="s1">happyHourDiscount </span><span class="s2">= </span><span class="s1">calculateHappyHourDiscount</span><span class="s2">(</span><span class="s1">basePrice</span><span class="s2">);</span>
        <span class="s0">double </span><span class="s1">categoryDiscount </span><span class="s2">= </span><span class="s1">calculateCategoryDiscount</span><span class="s2">(</span><span class="s1">item </span><span class="s2">!= </span><span class="s0">null </span><span class="s2">? </span><span class="s1">item</span><span class="s2">.</span><span class="s1">category </span><span class="s2">: </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s1">basePrice</span><span class="s2">);</span>

        <span class="s0">double </span><span class="s1">loyaltyDiscount </span><span class="s2">= </span><span class="s1">calculateLoyaltyDiscount</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s1">basePrice</span><span class="s2">);</span>
        <span class="s0">double </span><span class="s1">totalDiscount </span><span class="s2">= </span><span class="s1">happyHourDiscount </span><span class="s2">+ </span><span class="s1">categoryDiscount </span><span class="s2">+ </span><span class="s1">loyaltyDiscount</span><span class="s2">;</span>
        <span class="s0">double </span><span class="s1">finalPrice </span><span class="s2">= </span><span class="s1">basePrice </span><span class="s2">- </span><span class="s1">totalDiscount</span><span class="s2">;</span>

        <span class="s5">// Add free items to order</span>
        <span class="s1">List</span><span class="s2">&lt;</span><span class="s1">String</span><span class="s2">&gt; </span><span class="s1">freeItems </span><span class="s2">= </span><span class="s0">new </span><span class="s1">ArrayList</span><span class="s2">&lt;&gt;();</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">hasFreeCoffee</span><span class="s2">) {</span>
            <span class="s1">freeItems</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s3">&quot;Free Coffee&quot;</span><span class="s2">);</span>
            <span class="s5">// Mark free coffee as used</span>
            <span class="s1">redeemFreeCoffee</span><span class="s2">(</span><span class="s1">username</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">hasFreeMeal</span><span class="s2">) {</span>
            <span class="s1">freeItems</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s3">&quot;Free Meal&quot;</span><span class="s2">);</span>
            <span class="s5">// Mark free meal as used</span>
            <span class="s1">redeemFreeMeal</span><span class="s2">(</span><span class="s1">username</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s5">// Generate and display bill</span>
        <span class="s1">generateBill</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">, </span><span class="s1">quantity</span><span class="s2">, </span><span class="s1">username</span><span class="s2">, </span><span class="s1">freeItems</span><span class="s2">);</span>

        <span class="s0">if </span><span class="s2">(</span><span class="s1">item </span><span class="s2">!= </span><span class="s0">null</span><span class="s2">) {</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">popularity </span><span class="s2">+= </span><span class="s1">quantity</span><span class="s2">;</span>
            <span class="s1">String updatePopularity </span><span class="s2">= </span><span class="s3">&quot;UPDATE menu_items SET Popularity = ? WHERE ID = ?&quot;</span><span class="s2">;</span>
            <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">updatePopularity</span><span class="s2">)) {</span>
                <span class="s1">ps</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">item</span><span class="s2">.</span><span class="s1">popularity</span><span class="s2">);</span>
                <span class="s1">ps</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">itemId</span><span class="s2">);</span>
                <span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">if </span><span class="s2">(</span><span class="s1">itemId </span><span class="s2">!= </span><span class="s4">0 </span><span class="s2">|| !</span><span class="s1">freeItems</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
            <span class="s1">Order newOrder </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Order</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">, </span><span class="s1">quantity</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">orderQueue</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">newOrder</span><span class="s2">);</span>
            <span class="s1">processOrders</span><span class="s2">();</span>
            <span class="s1">logOrderToFile</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">, </span><span class="s1">quantity</span><span class="s2">, </span><span class="s1">username</span><span class="s2">, </span><span class="s1">freeItems</span><span class="s2">);</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">itemId </span><span class="s2">!= </span><span class="s4">0</span><span class="s2">) {</span>
                <span class="s5">// Calculate loyalty points based on final order value</span>
                <span class="s1">pointsEarned </span><span class="s2">= </span><span class="s1">calculateLoyaltyPoints</span><span class="s2">(</span><span class="s1">finalPrice</span><span class="s2">); </span><span class="s5">// Now pointsEarned is declared</span>
                <span class="s1">updateLoyaltyPoints</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s1">pointsEarned</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s5">// Send order confirmation email with discount and free items details</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">String emailSql </span><span class="s2">= </span><span class="s3">&quot;SELECT Email FROM users WHERE Username = ?&quot;</span><span class="s2">;</span>
                <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement emailPs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">emailSql</span><span class="s2">)) {</span>
                    <span class="s1">emailPs</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">emailPs</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                        <span class="s1">String recipientEmail </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Email&quot;</span><span class="s2">);</span>
                        <span class="s1">sendOrderConfirmationEmail</span><span class="s2">(</span><span class="s1">recipientEmail</span><span class="s2">, </span><span class="s1">username</span><span class="s2">,</span>
                                <span class="s1">item </span><span class="s2">!= </span><span class="s0">null </span><span class="s2">? </span><span class="s1">item</span><span class="s2">.</span><span class="s1">name </span><span class="s2">: </span><span class="s3">&quot;&quot;</span><span class="s2">,</span>
                                <span class="s1">quantity</span><span class="s2">,</span>
                                <span class="s1">basePrice</span><span class="s2">, </span><span class="s1">totalDiscount</span><span class="s2">,</span>
                                <span class="s1">finalPrice</span><span class="s2">, </span><span class="s1">freeItems</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">Exception e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Could not send confirmation email: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getMessage</span><span class="s2">());</span>
            <span class="s2">}</span>

            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Order added to queue. Your loyalty points have been updated...!&quot;</span><span class="s2">);</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">itemId </span><span class="s2">!= </span><span class="s4">0</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s1">pointsEarned </span><span class="s2">+ </span><span class="s3">&quot; points has been added for this order (value: Rs.&quot; </span><span class="s2">+ </span><span class="s1">finalPrice </span><span class="s2">+ </span><span class="s3">&quot;)&quot;</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">processOrders</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s0">try </span><span class="s2">{</span>
            <span class="s0">while </span><span class="s2">(!</span><span class="s1">orderQueue</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
                <span class="s1">Order order </span><span class="s2">= </span><span class="s1">orderQueue</span><span class="s2">.</span><span class="s1">poll</span><span class="s2">();</span>
                <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;INSERT INTO orders (ItemID, Quantity, Username, OrderTime, Status) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="s2">;</span>

                <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
                    <span class="s1">ps</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">order</span><span class="s2">.</span><span class="s1">itemId</span><span class="s2">);</span>
                    <span class="s1">ps</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">order</span><span class="s2">.</span><span class="s1">quantity</span><span class="s2">);</span>
                    <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s1">order</span><span class="s2">.</span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s1">ps</span><span class="s2">.</span><span class="s1">setTimestamp</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">valueOf</span><span class="s2">(</span><span class="s1">order</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">));</span>
                    <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s3">&quot;PENDING&quot;</span><span class="s2">);</span>
                    <span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
            <span class="s1">con</span><span class="s2">.</span><span class="s1">commit</span><span class="s2">();</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Orders successfully saved to database!&quot;</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">SQLException e</span><span class="s2">) {</span>
            <span class="s1">con</span><span class="s2">.</span><span class="s1">rollback</span><span class="s2">();</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Error saving orders: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getMessage</span><span class="s2">());</span>
            <span class="s0">throw </span><span class="s1">e</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static int </span><span class="s1">calculateLoyaltyPoints</span><span class="s2">(</span><span class="s0">double </span><span class="s1">orderValue</span><span class="s2">) {</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">orderValue </span><span class="s2">&gt; </span><span class="s4">200</span><span class="s2">) {</span>
            <span class="s0">return </span><span class="s4">5</span><span class="s2">; </span><span class="s5">// 5 points for orders over Rs. 200</span>
        <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">orderValue </span><span class="s2">&gt; </span><span class="s4">150</span><span class="s2">) {</span>
            <span class="s0">return </span><span class="s4">4</span><span class="s2">; </span><span class="s5">// 4 points for orders over Rs. 150</span>
        <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">orderValue </span><span class="s2">&gt; </span><span class="s4">100</span><span class="s2">) {</span>
            <span class="s0">return </span><span class="s4">3</span><span class="s2">; </span><span class="s5">// 3 points for orders over Rs. 100</span>
        <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">orderValue </span><span class="s2">&gt; </span><span class="s4">50</span><span class="s2">) {</span>
            <span class="s0">return </span><span class="s4">2</span><span class="s2">; </span><span class="s5">// 2 points for orders over Rs. 50</span>
        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
            <span class="s0">return </span><span class="s4">1</span><span class="s2">; </span><span class="s5">// 1 point for all other orders</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s5">// Helper methods for free items</span>
    <span class="s0">static boolean </span><span class="s1">checkForFreeCoffee</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;SELECT Points FROM loyalty_program WHERE Username = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>
            <span class="s0">return </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">() &amp;&amp; </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Points&quot;</span><span class="s2">) &gt;= </span><span class="s4">50</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static boolean </span><span class="s1">checkForFreeMeal</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;SELECT Points FROM loyalty_program WHERE Username = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>
            <span class="s0">return </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">() &amp;&amp; </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Points&quot;</span><span class="s2">) &gt;= </span><span class="s4">200</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static double </span><span class="s1">calculateLoyaltyDiscount</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">, </span><span class="s0">double </span><span class="s1">basePrice</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;SELECT Points FROM loyalty_program WHERE Username = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s0">int </span><span class="s1">points </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Points&quot;</span><span class="s2">);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">points </span><span class="s2">&gt;= </span><span class="s4">100</span><span class="s2">) {</span>
                    <span class="s0">return </span><span class="s1">basePrice </span><span class="s2">* </span><span class="s4">0.20</span><span class="s2">; </span><span class="s5">// 20% discount for 100+ points</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s0">return </span><span class="s4">0</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">redeemFreeCoffee</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;UPDATE loyalty_program SET Points = Points - 50 WHERE Username = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">redeemFreeMeal</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;UPDATE loyalty_program SET Points = Points - 200 WHERE Username = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">loyaltyProgram</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- LOYALTY PROGRAM ---&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter customer name: &quot;</span><span class="s2">);</span>
        <span class="s1">String username </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>

        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;SELECT Points, LastVisit FROM loyalty_program WHERE Username = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s0">int </span><span class="s1">points </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Points&quot;</span><span class="s2">);</span>
                <span class="s1">Date lastVisit </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getDate</span><span class="s2">(</span><span class="s3">&quot;LastVisit&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;Customer: %s</span><span class="s0">\n</span><span class="s3">Points: %d</span><span class="s0">\n</span><span class="s3">Last Visit: %s</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">,</span>
                        <span class="s1">username</span><span class="s2">, </span><span class="s1">points</span><span class="s2">, </span><span class="s1">lastVisit</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">());</span>

                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Rewards available:&quot;</span><span class="s2">);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">points </span><span class="s2">&gt;= </span><span class="s4">50</span><span class="s2">) </span><span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;- Free Coffee (50 points)&quot;</span><span class="s2">);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">points </span><span class="s2">&gt;= </span><span class="s4">100</span><span class="s2">) </span><span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;- 20% Discount (100 points)&quot;</span><span class="s2">);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">points </span><span class="s2">&gt;= </span><span class="s4">200</span><span class="s2">) </span><span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;- Free Meal (200 points)&quot;</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;No record found for &quot; </span><span class="s2">+ </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">updateLoyaltyPoints</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">, </span><span class="s0">int </span><span class="s1">pointsToAdd</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String checkSql </span><span class="s2">= </span><span class="s3">&quot;SELECT Points FROM loyalty_program WHERE Username = ?&quot;</span><span class="s2">;</span>
        <span class="s1">String updateSql </span><span class="s2">= </span><span class="s3">&quot;UPDATE loyalty_program SET Points = ?, LastVisit = ? WHERE Username = ?&quot;</span><span class="s2">;</span>
        <span class="s1">String insertSql </span><span class="s2">= </span><span class="s3">&quot;INSERT INTO loyalty_program (Username, Points, LastVisit) VALUES (?, ?, ?)&quot;</span><span class="s2">;</span>

        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement checkPs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">checkSql</span><span class="s2">)) {</span>
            <span class="s1">checkPs</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">checkPs</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s0">int </span><span class="s1">currentPoints </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Points&quot;</span><span class="s2">);</span>
                <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement updatePs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">updateSql</span><span class="s2">)) {</span>
                    <span class="s1">updatePs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">currentPoints </span><span class="s2">+ </span><span class="s1">pointsToAdd</span><span class="s2">);</span>
                    <span class="s1">updatePs</span><span class="s2">.</span><span class="s1">setDate</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">Date</span><span class="s2">.</span><span class="s1">valueOf</span><span class="s2">(</span><span class="s1">LocalDate</span><span class="s2">.</span><span class="s1">now</span><span class="s2">()));</span>
                    <span class="s1">updatePs</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s1">updatePs</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement insertPs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">insertSql</span><span class="s2">)) {</span>
                    <span class="s1">insertPs</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s1">insertPs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">pointsToAdd</span><span class="s2">);</span>
                    <span class="s1">insertPs</span><span class="s2">.</span><span class="s1">setDate</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s1">Date</span><span class="s2">.</span><span class="s1">valueOf</span><span class="s2">(</span><span class="s1">LocalDate</span><span class="s2">.</span><span class="s1">now</span><span class="s2">()));</span>
                    <span class="s1">insertPs</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">viewOrderStatus</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- YOUR ORDER STATUS ---&quot;</span><span class="s2">);</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;SELECT o.*, m.Name FROM orders o JOIN menu_items m ON o.ItemID = m.ID &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;WHERE Username = ? ORDER BY OrderTime DESC&quot;</span><span class="s2">;</span>

        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

            <span class="s0">boolean </span><span class="s1">hasOrders </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
            <span class="s0">while </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s1">hasOrders </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;Order #%d | %-20s | Qty: %-3d | Rs.%-6.2f | %-8s | %s</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">,</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;OrderID&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Name&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Quantity&quot;</span><span class="s2">),</span>
                        <span class="s1">menuMap</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;ItemID&quot;</span><span class="s2">)).</span><span class="s1">price </span><span class="s2">* </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Quantity&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Status&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getTimestamp</span><span class="s2">(</span><span class="s3">&quot;OrderTime&quot;</span><span class="s2">).</span><span class="s1">toLocalDateTime</span><span class="s2">()</span>
                                <span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">DateTimeFormatter</span><span class="s2">.</span><span class="s1">ofPattern</span><span class="s2">(</span><span class="s3">&quot;yyyy-MM-dd HH:mm&quot;</span><span class="s2">)));</span>
            <span class="s2">}</span>

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">hasOrders</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;No orders found for &quot; </span><span class="s2">+ </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">viewLoyaltyPoints</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;SELECT Points FROM loyalty_program WHERE Username = ?&quot;</span><span class="s2">;</span>

        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s0">int </span><span class="s1">points </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Points&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- YOUR LOYALTY POINTS ---&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Customer: &quot; </span><span class="s2">+ </span><span class="s1">username</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Points: &quot; </span><span class="s2">+ </span><span class="s1">points</span><span class="s2">);</span>

                <span class="s5">// Display points earning structure</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Points Earning Structure:&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;- Rs. 0-50: 1 point&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;- Rs. 51-100: 2 points&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;- Rs. 101-150: 3 points&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;- Rs. 151-200: 4 points&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;- Rs. 200+: 5 points&quot;</span><span class="s2">);</span>

                <span class="s5">// Check and redeem rewards in sequence</span>
                <span class="s0">boolean </span><span class="s1">continueChecking </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s1">continueChecking</span><span class="s2">) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">points </span><span class="s2">&gt;= </span><span class="s4">50 </span><span class="s2">&amp;&amp; </span><span class="s1">points </span><span class="s2">&lt; </span><span class="s4">100</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Hurray! You've won a FREE COFFEE!&quot;</span><span class="s2">);</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Would you like to redeem your 50 points for a free coffee? (yes/no): &quot;</span><span class="s2">);</span>
                        <span class="s1">String choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>

                        <span class="s0">if </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;yes&quot;</span><span class="s2">)) {</span>
                            <span class="s1">points </span><span class="s2">-= </span><span class="s4">50</span><span class="s2">;</span>
                            <span class="s1">updatePointsInDatabase</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s1">points</span><span class="s2">);</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Congratulations! Your free coffee has been redeemed!&quot;</span><span class="s2">);</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Remaining points: &quot; </span><span class="s2">+ </span><span class="s1">points</span><span class="s2">);</span>
                        <span class="s2">}</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Next reward: 20% Discount at 100 points&quot;</span><span class="s2">);</span>
                        <span class="s1">continueChecking </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s0">else if </span><span class="s2">(</span><span class="s1">points </span><span class="s2">&gt;= </span><span class="s4">100 </span><span class="s2">&amp;&amp; </span><span class="s1">points </span><span class="s2">&lt; </span><span class="s4">200</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Hurray! You've earned a 20% DISCOUNT!&quot;</span><span class="s2">);</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Would you like to redeem your 100 points for a 20% discount? (yes/no): &quot;</span><span class="s2">);</span>
                        <span class="s1">String choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>

                        <span class="s0">if </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;yes&quot;</span><span class="s2">)) {</span>
                            <span class="s1">points </span><span class="s2">-= </span><span class="s4">100</span><span class="s2">;</span>
                            <span class="s1">updatePointsInDatabase</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s1">points</span><span class="s2">);</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Congratulations! Your 20% discount has been applied to your next order!&quot;</span><span class="s2">);</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Remaining points: &quot; </span><span class="s2">+ </span><span class="s1">points</span><span class="s2">);</span>
                        <span class="s2">}</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Next reward: Free Meal at 200 points&quot;</span><span class="s2">);</span>
                        <span class="s1">continueChecking </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s0">else if </span><span class="s2">(</span><span class="s1">points </span><span class="s2">&gt;= </span><span class="s4">200</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Hurray! You've earned a FREE MEAL!&quot;</span><span class="s2">);</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Would you like to redeem your 200 points for a free meal? (yes/no): &quot;</span><span class="s2">);</span>
                        <span class="s1">String choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>

                        <span class="s0">if </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;yes&quot;</span><span class="s2">)) {</span>
                            <span class="s1">points </span><span class="s2">-= </span><span class="s4">200</span><span class="s2">;</span>
                            <span class="s1">updatePointsInDatabase</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s1">points</span><span class="s2">);</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Congratulations! Your free meal has been redeemed!&quot;</span><span class="s2">);</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Remaining points: &quot; </span><span class="s2">+ </span><span class="s1">points</span><span class="s2">);</span>
                        <span class="s2">}</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">You've reached the maximum reward level!&quot;</span><span class="s2">);</span>
                        <span class="s1">continueChecking </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Keep ordering to earn more points!&quot;</span><span class="s2">);</span>
                        <span class="s1">continueChecking </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;No loyalty points found. Start ordering to earn points!&quot;</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s5">// manager mode methods</span>
    <span class="s0">static void </span><span class="s1">loadMenuItems</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">menuMap</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">();</span>
        <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">st</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">(</span><span class="s3">&quot;SELECT * FROM menu_items&quot;</span><span class="s2">);</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
            <span class="s0">int </span><span class="s1">id </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;ID&quot;</span><span class="s2">);</span>
            <span class="s1">String name </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Name&quot;</span><span class="s2">);</span>
            <span class="s1">String category </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Category&quot;</span><span class="s2">);</span>
            <span class="s0">double </span><span class="s1">price </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getDouble</span><span class="s2">(</span><span class="s3">&quot;Price&quot;</span><span class="s2">);</span>
            <span class="s0">boolean </span><span class="s1">availability </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getBoolean</span><span class="s2">(</span><span class="s3">&quot;availability&quot;</span><span class="s2">);</span>
            <span class="s0">int </span><span class="s1">popularity </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Popularity&quot;</span><span class="s2">);</span>

            <span class="s1">MenuItem item </span><span class="s2">= </span><span class="s0">new </span><span class="s1">MenuItem</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">price</span><span class="s2">, </span><span class="s1">availability</span><span class="s2">);</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">popularity </span><span class="s2">= </span><span class="s1">popularity</span><span class="s2">;</span>
            <span class="s1">menuMap</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">item</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">managerMode</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- MANAGER MODE ---&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;1. Menu Management&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;2. Order Management&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;3. Generate sales report&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;4. Manage Special Offers&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;5. View Loyalty Program Report&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;6. Back to Main Menu&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Choice: &quot;</span><span class="s2">);</span>

            <span class="s0">int </span><span class="s1">choice</span><span class="s2">;</span>
            <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                <span class="s0">try </span><span class="s2">{</span>
                    <span class="s1">choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">choice </span><span class="s2">&gt;= </span><span class="s4">1 </span><span class="s2">&amp;&amp; </span><span class="s1">choice </span><span class="s2">&lt;= </span><span class="s4">6</span><span class="s2">) {</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter a number between 1 and 6: &quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a number between 1 and 6: &quot;</span><span class="s2">);</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s0">switch </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">) {</span>
                <span class="s0">case </span><span class="s4">1</span><span class="s2">:</span>
                    <span class="s1">menuManagement</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">2</span><span class="s2">:</span>
                    <span class="s1">orderManagement</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">3</span><span class="s2">:</span>
                    <span class="s1">generateSalesReport</span><span class="s2">();</span>

                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">4</span><span class="s2">:</span>
                    <span class="s1">specialOffers</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">5</span><span class="s2">:</span>
                    <span class="s1">loyaltyProgramReport</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">6</span><span class="s2">:</span>
                    <span class="s0">return</span><span class="s2">;</span>

            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">menuManagement</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- MENU MANAGEMENT ---&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;1. Add Menu Item&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;2. Update Menu Item&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;3. Delete Menu Item&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;4. View All Menu Items&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;5. Bulk Update Availability&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;6. Back to Manager Menu&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Choice: &quot;</span><span class="s2">);</span>

            <span class="s0">int </span><span class="s1">choice</span><span class="s2">;</span>
            <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                <span class="s0">try </span><span class="s2">{</span>
                    <span class="s1">choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">choice </span><span class="s2">&gt;= </span><span class="s4">1 </span><span class="s2">&amp;&amp; </span><span class="s1">choice </span><span class="s2">&lt;= </span><span class="s4">6</span><span class="s2">) {</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter a number between 1 and 6: &quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a number between 1 and 6: &quot;</span><span class="s2">);</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s0">switch </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">) {</span>
                <span class="s0">case </span><span class="s4">1</span><span class="s2">:</span>
                    <span class="s1">addMenuItem</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">2</span><span class="s2">:</span>
                    <span class="s1">updateMenuItem</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">3</span><span class="s2">:</span>
                    <span class="s1">deleteMenuItem</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">4</span><span class="s2">:</span>
                    <span class="s1">displayMenu</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">5</span><span class="s2">:</span>
                    <span class="s1">bulkUpdateAvailability</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">6</span><span class="s2">:</span>
                    <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">addMenuItem</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter Item Name: &quot;</span><span class="s2">);</span>
        <span class="s1">String name </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter Category: &quot;</span><span class="s2">);</span>
        <span class="s1">String category </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter Price: &quot;</span><span class="s2">);</span>
        <span class="s0">double </span><span class="s1">price</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">price </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextDouble</span><span class="s2">();</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">price </span><span class="s2">&gt;= </span><span class="s4">0</span><span class="s2">) {</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Price cannot be negative. Please enter again: &quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input! Please enter a number: &quot;</span><span class="s2">);</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Is available (true/false): &quot;</span><span class="s2">);</span>
        <span class="s0">boolean </span><span class="s1">availability</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s1">String input </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">input</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;true&quot;</span><span class="s2">) || </span><span class="s1">input</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;false&quot;</span><span class="s2">)) {</span>
                <span class="s1">availability </span><span class="s2">= </span><span class="s1">Boolean</span><span class="s2">.</span><span class="s1">parseBoolean</span><span class="s2">(</span><span class="s1">input</span><span class="s2">);</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter 'true' or 'false': &quot;</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;INSERT INTO menu_items (ID, Name, Category, Price, availability) &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;VALUES ((SELECT IFNULL(MAX(ID), 0) + 1 FROM menu_items m), ?, ?, ?, ?)&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">name</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">category</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setDouble</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s1">price</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setBoolean</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s1">availability</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s1">loadMenuItems</span><span class="s2">();</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Menu item added successfully!&quot;</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">deleteMenuItem</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- DELETE MENU ITEM ---&quot;</span><span class="s2">);</span>
        <span class="s1">displayMenu</span><span class="s2">();</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter Item ID to delete: &quot;</span><span class="s2">);</span>
        <span class="s0">int </span><span class="s1">itemId</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">itemId </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">menuMap</span><span class="s2">.</span><span class="s1">containsKey</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">)) {</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Item ID not found! Please enter a valid ID: &quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input! Please enter a numeric ID: &quot;</span><span class="s2">);</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">String checkOrdersSql </span><span class="s2">= </span><span class="s3">&quot;SELECT COUNT(*) FROM orders WHERE ItemID = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">checkOrdersSql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">itemId</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">() &amp;&amp; </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">) &gt; </span><span class="s4">0</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Cannot delete this item because it has existing orders!&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;You can set it as unavailable instead.&quot;</span><span class="s2">);</span>
                <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Are you sure you want to delete item ID &quot; </span><span class="s2">+ </span><span class="s1">itemId </span><span class="s2">+ </span><span class="s3">&quot;? (yes/no): &quot;</span><span class="s2">);</span>
        <span class="s1">String confirmation </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>
        <span class="s0">if </span><span class="s2">(!</span><span class="s1">confirmation</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;yes&quot;</span><span class="s2">)) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Deletion cancelled.&quot;</span><span class="s2">);</span>
            <span class="s0">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;DELETE FROM menu_items WHERE ID = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">itemId</span><span class="s2">);</span>
            <span class="s0">int </span><span class="s1">rows </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">rows </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">) {</span>
                <span class="s1">menuMap</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Menu item deleted successfully!&quot;</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Failed to delete menu item.&quot;</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">updateMenuItem</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- UPDATE MENU ITEM ---&quot;</span><span class="s2">);</span>
        <span class="s1">displayMenu</span><span class="s2">();</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter Item ID to update: &quot;</span><span class="s2">);</span>
        <span class="s0">int </span><span class="s1">itemId</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">itemId </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">menuMap</span><span class="s2">.</span><span class="s1">containsKey</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">)) {</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Item ID not found! Please enter a valid ID: &quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input! Please enter a numeric ID: &quot;</span><span class="s2">);</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s1">MenuItem item </span><span class="s2">= </span><span class="s1">menuMap</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Current Details:&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s1">item</span><span class="s2">);</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">What would you like to update?&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;1. Name&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;2. Category&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;3. Price&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;4. Availability&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;5. All Fields&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;6. Cancel Update&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Choice: &quot;</span><span class="s2">);</span>

        <span class="s0">int </span><span class="s1">choice</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">choice </span><span class="s2">&gt;= </span><span class="s4">1 </span><span class="s2">&amp;&amp; </span><span class="s1">choice </span><span class="s2">&lt;= </span><span class="s4">6</span><span class="s2">) {</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter a number between 1 and 6: &quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a number between 1 and 6: &quot;</span><span class="s2">);</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">String name </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
        <span class="s1">String category </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">category</span><span class="s2">;</span>
        <span class="s0">double </span><span class="s1">price </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">price</span><span class="s2">;</span>
        <span class="s0">boolean </span><span class="s1">availability </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">availability</span><span class="s2">;</span>

        <span class="s0">switch </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">) {</span>
            <span class="s0">case </span><span class="s4">1</span><span class="s2">:</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter new Name: &quot;</span><span class="s2">);</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s0">case </span><span class="s4">2</span><span class="s2">:</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter new Category: &quot;</span><span class="s2">);</span>
                <span class="s1">category </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s0">case </span><span class="s4">3</span><span class="s2">:</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter new Price: &quot;</span><span class="s2">);</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s1">price </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextDouble</span><span class="s2">();</span>
                        <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">price </span><span class="s2">&gt;= </span><span class="s4">0</span><span class="s2">) {</span>
                            <span class="s0">break</span><span class="s2">;</span>
                        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Price cannot be negative. Please enter again: &quot;</span><span class="s2">);</span>
                        <span class="s2">}</span>
                    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input! Please enter a number: &quot;</span><span class="s2">);</span>
                        <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s0">case </span><span class="s4">4</span><span class="s2">:</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Set Availability (true/false): &quot;</span><span class="s2">);</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s1">String input </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">input</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;true&quot;</span><span class="s2">) || </span><span class="s1">input</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;false&quot;</span><span class="s2">)) {</span>
                        <span class="s1">availability </span><span class="s2">= </span><span class="s1">Boolean</span><span class="s2">.</span><span class="s1">parseBoolean</span><span class="s2">(</span><span class="s1">input</span><span class="s2">);</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter 'true' or 'false': &quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s0">case </span><span class="s4">5</span><span class="s2">:</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter new Name: &quot;</span><span class="s2">);</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter new Category: &quot;</span><span class="s2">);</span>
                <span class="s1">category </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter new Price: &quot;</span><span class="s2">);</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s1">price </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextDouble</span><span class="s2">();</span>
                        <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">price </span><span class="s2">&gt;= </span><span class="s4">0</span><span class="s2">) {</span>
                            <span class="s0">break</span><span class="s2">;</span>
                        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Price cannot be negative. Please enter again: &quot;</span><span class="s2">);</span>
                        <span class="s2">}</span>
                    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input! Please enter a number: &quot;</span><span class="s2">);</span>
                        <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Set Availability (true/false): &quot;</span><span class="s2">);</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s1">String input </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">input</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;true&quot;</span><span class="s2">) || </span><span class="s1">input</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;false&quot;</span><span class="s2">)) {</span>
                        <span class="s1">availability </span><span class="s2">= </span><span class="s1">Boolean</span><span class="s2">.</span><span class="s1">parseBoolean</span><span class="s2">(</span><span class="s1">input</span><span class="s2">);</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter 'true' or 'false': &quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s0">case </span><span class="s4">6</span><span class="s2">:</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Update cancelled.&quot;</span><span class="s2">);</span>
                <span class="s0">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;UPDATE menu_items SET Name = ?, Category = ?, Price = ?, availability = ? WHERE ID = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">name</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">category</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setDouble</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s1">price</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setBoolean</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s1">availability</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s1">itemId</span><span class="s2">);</span>
            <span class="s0">int </span><span class="s1">rows </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">rows </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">) {</span>
                <span class="s1">item</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">name</span><span class="s2">;</span>
                <span class="s1">item</span><span class="s2">.</span><span class="s1">category </span><span class="s2">= </span><span class="s1">category</span><span class="s2">;</span>
                <span class="s1">item</span><span class="s2">.</span><span class="s1">price </span><span class="s2">= </span><span class="s1">price</span><span class="s2">;</span>
                <span class="s1">item</span><span class="s2">.</span><span class="s1">availability </span><span class="s2">= </span><span class="s1">availability</span><span class="s2">;</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Menu item updated successfully!&quot;</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Failed to update menu item.&quot;</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">bulkUpdateAvailability</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter category to update (or 'all' for all items): &quot;</span><span class="s2">);</span>
        <span class="s1">String category </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">();</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Set availability to (true/false): &quot;</span><span class="s2">);</span>
        <span class="s0">boolean </span><span class="s1">availability</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s1">String input </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">input</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;true&quot;</span><span class="s2">) || </span><span class="s1">input</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;false&quot;</span><span class="s2">)) {</span>
                <span class="s1">availability </span><span class="s2">= </span><span class="s1">Boolean</span><span class="s2">.</span><span class="s1">parseBoolean</span><span class="s2">(</span><span class="s1">input</span><span class="s2">);</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter 'true' or 'false': &quot;</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">String sql</span><span class="s2">;</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s3">&quot;all&quot;</span><span class="s2">.</span><span class="s1">equalsIgnoreCase</span><span class="s2">(</span><span class="s1">category</span><span class="s2">)) {</span>
            <span class="s1">sql </span><span class="s2">= </span><span class="s3">&quot;UPDATE menu_items SET availability = ?&quot;</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
            <span class="s1">sql </span><span class="s2">= </span><span class="s3">&quot;UPDATE menu_items SET availability = ? WHERE Category = ?&quot;</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setBoolean</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">availability</span><span class="s2">);</span>
            <span class="s0">if </span><span class="s2">(!</span><span class="s3">&quot;all&quot;</span><span class="s2">.</span><span class="s1">equalsIgnoreCase</span><span class="s2">(</span><span class="s1">category</span><span class="s2">)) {</span>
                <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">category</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s0">int </span><span class="s1">count </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Updated &quot; </span><span class="s2">+ </span><span class="s1">count </span><span class="s2">+ </span><span class="s3">&quot; items.&quot;</span><span class="s2">);</span>
            <span class="s5">// Commit the changes for the update to take effect in the database</span>
            <span class="s1">con</span><span class="s2">.</span><span class="s1">commit</span><span class="s2">();</span>
            <span class="s5">// Reload the menu items to reflect updated availability in memory</span>
            <span class="s1">loadMenuItems</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">SQLException e</span><span class="s2">) {</span>
            <span class="s1">con</span><span class="s2">.</span><span class="s1">rollback</span><span class="s2">();</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Error during bulk update: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getMessage</span><span class="s2">());</span>
            <span class="s0">throw </span><span class="s1">e</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>


    <span class="s0">static void </span><span class="s1">orderManagement</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- ORDER MANAGEMENT ---&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;1. View All Orders&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;2. View Pending Orders&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;3. Mark Order as Completed&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;4. Cancel Order&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;5. Back to Manager Menu&quot;</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Choice: &quot;</span><span class="s2">);</span>

            <span class="s0">int </span><span class="s1">choice</span><span class="s2">;</span>
            <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                <span class="s0">try </span><span class="s2">{</span>
                    <span class="s1">choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">choice </span><span class="s2">&gt;= </span><span class="s4">1 </span><span class="s2">&amp;&amp; </span><span class="s1">choice </span><span class="s2">&lt;= </span><span class="s4">5</span><span class="s2">) {</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter a number between 1 and 5: &quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a number between 1 and 5: &quot;</span><span class="s2">);</span>
                    <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s0">switch </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">) {</span>
                <span class="s0">case </span><span class="s4">1</span><span class="s2">:</span>
                    <span class="s1">displayMenu</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">2</span><span class="s2">:</span>
                    <span class="s1">viewPendingOrders</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">3</span><span class="s2">:</span>
                    <span class="s1">markOrderCompleted</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">4</span><span class="s2">:</span>
                    <span class="s1">cancelOrder</span><span class="s2">();</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s0">case </span><span class="s4">5</span><span class="s2">:</span>
                    <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">viewPendingOrders</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- PENDING ORDERS ---&quot;</span><span class="s2">);</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;SELECT o.*, m.Name FROM orders o &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;JOIN menu_items m ON o.ItemID = m.ID &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;WHERE Status = 'PENDING' &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;ORDER BY OrderTime ASC&quot;</span><span class="s2">;</span>

        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;%-8s %-20s %-15s %-6s %-10s %-20s</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">,</span>
                    <span class="s3">&quot;OrderID&quot;</span><span class="s2">, </span><span class="s3">&quot;Item&quot;</span><span class="s2">, </span><span class="s3">&quot;Category&quot;</span><span class="s2">, </span><span class="s3">&quot;Qty&quot;</span><span class="s2">, </span><span class="s3">&quot;Customer&quot;</span><span class="s2">, </span><span class="s3">&quot;Order Time&quot;</span><span class="s2">);</span>

            <span class="s0">boolean </span><span class="s1">hasOrders </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
            <span class="s0">while </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s1">hasOrders </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s1">MenuItem item </span><span class="s2">= </span><span class="s1">menuMap</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;ItemID&quot;</span><span class="s2">));</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;%-8d %-20s %-15s %-6d %-10s %-20s</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">,</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;OrderID&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Name&quot;</span><span class="s2">),</span>
                        <span class="s1">item</span><span class="s2">.</span><span class="s1">category</span><span class="s2">,</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Quantity&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Username&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getTimestamp</span><span class="s2">(</span><span class="s3">&quot;OrderTime&quot;</span><span class="s2">).</span><span class="s1">toLocalDateTime</span><span class="s2">()</span>
                                <span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">DateTimeFormatter</span><span class="s2">.</span><span class="s1">ofPattern</span><span class="s2">(</span><span class="s3">&quot;MM-dd HH:mm&quot;</span><span class="s2">)));</span>
            <span class="s2">}</span>

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">hasOrders</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;No pending orders found.&quot;</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>


    <span class="s0">static void </span><span class="s1">generateSalesReport</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s5">// Start Date Validation</span>
        <span class="s1">LocalDate startDate </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s1">startDate </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter start date (YYYY-MM-DD): &quot;</span><span class="s2">);</span>
            <span class="s1">String startInput </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">startDate </span><span class="s2">= </span><span class="s1">LocalDate</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">startInput</span><span class="s2">);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">startDate</span><span class="s2">.</span><span class="s1">isAfter</span><span class="s2">(</span><span class="s1">LocalDate</span><span class="s2">.</span><span class="s1">now</span><span class="s2">())) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Start date cannot be in the future!&quot;</span><span class="s2">);</span>
                    <span class="s1">startDate </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">Exception e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid date format. Please use YYYY-MM-DD.&quot;</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s5">// End Date Validation</span>
        <span class="s1">LocalDate endDate </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s1">endDate </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter end date (YYYY-MM-DD): &quot;</span><span class="s2">);</span>
            <span class="s1">String endInput </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">endDate </span><span class="s2">= </span><span class="s1">LocalDate</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">endInput</span><span class="s2">);</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">endDate</span><span class="s2">.</span><span class="s1">isBefore</span><span class="s2">(</span><span class="s1">startDate</span><span class="s2">)) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;End date cannot be before start date!&quot;</span><span class="s2">);</span>
                    <span class="s1">endDate </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                    <span class="s0">continue</span><span class="s2">;</span>
                <span class="s2">}</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">endDate</span><span class="s2">.</span><span class="s1">isAfter</span><span class="s2">(</span><span class="s1">LocalDate</span><span class="s2">.</span><span class="s1">now</span><span class="s2">())) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;End date cannot be in the future!&quot;</span><span class="s2">);</span>
                    <span class="s1">endDate </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                <span class="s2">}</span>

                <span class="s1">LocalDate oneYearLater </span><span class="s2">= </span><span class="s1">startDate</span><span class="s2">.</span><span class="s1">plusYears</span><span class="s2">(</span><span class="s4">1</span><span class="s2">);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">endDate</span><span class="s2">.</span><span class="s1">isAfter</span><span class="s2">(</span><span class="s1">oneYearLater</span><span class="s2">)) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Date range exceeds 1 year! Do you want to continue? (yes/no): &quot;</span><span class="s2">);</span>
                    <span class="s1">String confirm </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">confirm</span><span class="s2">.</span><span class="s1">equalsIgnoreCase</span><span class="s2">(</span><span class="s3">&quot;yes&quot;</span><span class="s2">)) {</span>
                        <span class="s1">endDate </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">Exception e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid date format. Please use YYYY-MM-DD.&quot;</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s0">int </span><span class="s1">daysBetween </span><span class="s2">= </span><span class="s4">0</span><span class="s2">;</span>
        <span class="s1">LocalDate tempDate </span><span class="s2">= </span><span class="s1">startDate</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(!</span><span class="s1">tempDate</span><span class="s2">.</span><span class="s1">isAfter</span><span class="s2">(</span><span class="s1">endDate</span><span class="s2">)) {</span>
            <span class="s1">daysBetween</span><span class="s2">++;</span>
            <span class="s1">tempDate </span><span class="s2">= </span><span class="s1">tempDate</span><span class="s2">.</span><span class="s1">plusDays</span><span class="s2">(</span><span class="s4">1</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s5">// Corrected SQL query</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;SELECT m.Name, m.Category, SUM(o.Quantity) AS TotalQty, SUM(o.Quantity * m.Price) AS TotalSales &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;FROM orders o JOIN menu_items m ON o.ItemID = m.ID &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;WHERE DATE(o.OrderTime) BETWEEN ? AND ? AND o.Status = 'COMPLETED' &quot; </span><span class="s2">+</span>
                <span class="s3">&quot;GROUP BY m.Name, m.Category ORDER BY TotalSales DESC&quot;</span><span class="s2">;</span>

        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">,</span>
                <span class="s1">ResultSet</span><span class="s2">.</span><span class="s1">TYPE_SCROLL_INSENSITIVE</span><span class="s2">,</span>
                <span class="s1">ResultSet</span><span class="s2">.</span><span class="s1">CONCUR_READ_ONLY</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setDate</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">Date</span><span class="s2">.</span><span class="s1">valueOf</span><span class="s2">(</span><span class="s1">startDate</span><span class="s2">));</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setDate</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">Date</span><span class="s2">.</span><span class="s1">valueOf</span><span class="s2">(</span><span class="s1">endDate</span><span class="s2">));</span>

            <span class="s0">try </span><span class="s2">(</span><span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">()) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- SALES REPORT (&quot; </span><span class="s2">+ </span><span class="s1">startDate </span><span class="s2">+ </span><span class="s3">&quot; to &quot; </span><span class="s2">+ </span><span class="s1">endDate </span><span class="s2">+ </span><span class="s3">&quot;) ---&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;%-20s %-15s %-10s %-10s</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s3">&quot;Item&quot;</span><span class="s2">, </span><span class="s3">&quot;Category&quot;</span><span class="s2">, </span><span class="s3">&quot;Quantity&quot;</span><span class="s2">, </span><span class="s3">&quot;Total Sales&quot;</span><span class="s2">);</span>

                <span class="s0">double </span><span class="s1">grandTotal </span><span class="s2">= </span><span class="s4">0</span><span class="s2">;</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                    <span class="s1">String name </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Name&quot;</span><span class="s2">);</span>
                    <span class="s1">String category </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Category&quot;</span><span class="s2">);</span>
                    <span class="s0">int </span><span class="s1">qty </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;TotalQty&quot;</span><span class="s2">);</span>
                    <span class="s0">double </span><span class="s1">sales </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getDouble</span><span class="s2">(</span><span class="s3">&quot;TotalSales&quot;</span><span class="s2">);</span>
                    <span class="s1">grandTotal </span><span class="s2">+= </span><span class="s1">sales</span><span class="s2">;</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;%-20s %-15s %-10d %-9.2f</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">qty</span><span class="s2">, </span><span class="s1">sales</span><span class="s2">);</span>
                <span class="s2">}</span>

                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;-----------------------------------------&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;Total Days: %d</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">daysBetween</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;GRAND TOTAL: %.2f</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">grandTotal</span><span class="s2">);</span>

                <span class="s5">// Create a new ResultSet for saving to file</span>
                <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps2 </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">,</span>
                        <span class="s1">ResultSet</span><span class="s2">.</span><span class="s1">TYPE_SCROLL_INSENSITIVE</span><span class="s2">,</span>
                        <span class="s1">ResultSet</span><span class="s2">.</span><span class="s1">CONCUR_READ_ONLY</span><span class="s2">)) {</span>
                    <span class="s1">ps2</span><span class="s2">.</span><span class="s1">setDate</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">Date</span><span class="s2">.</span><span class="s1">valueOf</span><span class="s2">(</span><span class="s1">startDate</span><span class="s2">));</span>
                    <span class="s1">ps2</span><span class="s2">.</span><span class="s1">setDate</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">Date</span><span class="s2">.</span><span class="s1">valueOf</span><span class="s2">(</span><span class="s1">endDate</span><span class="s2">));</span>
                    <span class="s0">try </span><span class="s2">(</span><span class="s1">ResultSet rs2 </span><span class="s2">= </span><span class="s1">ps2</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">()) {</span>
                        <span class="s1">saveReportToFile</span><span class="s2">(</span><span class="s1">startDate</span><span class="s2">, </span><span class="s1">endDate</span><span class="s2">, </span><span class="s1">rs2</span><span class="s2">, </span><span class="s1">daysBetween</span><span class="s2">, </span><span class="s1">grandTotal</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">private static void </span><span class="s1">saveReportToFile</span><span class="s2">(</span><span class="s1">LocalDate startDate</span><span class="s2">, </span><span class="s1">LocalDate endDate</span><span class="s2">,</span>
                                         <span class="s1">ResultSet rs</span><span class="s2">, </span><span class="s0">int </span><span class="s1">daysBetween</span><span class="s2">, </span><span class="s0">double </span><span class="s1">grandTotal</span><span class="s2">)</span>
            <span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s5">// Create a valid filename without special characters</span>
        <span class="s1">String filename </span><span class="s2">= </span><span class="s3">&quot;sales_report_&quot; </span><span class="s2">+ </span><span class="s1">startDate </span><span class="s2">+ </span><span class="s3">&quot;_to_&quot; </span><span class="s2">+ </span><span class="s1">endDate </span><span class="s2">+ </span><span class="s3">&quot;.txt&quot;</span><span class="s2">;</span>

        <span class="s5">// Save to current working directory or a specific valid path</span>
        <span class="s1">String filePath </span><span class="s2">=</span><span class="s3">&quot;C:</span><span class="s0">\\</span><span class="s3">java</span><span class="s0">\\</span><span class="s3">&quot;</span><span class="s2">+ </span><span class="s1">filename</span><span class="s2">; </span><span class="s5">// saves to current directory</span>

        <span class="s0">try </span><span class="s2">(</span><span class="s1">PrintWriter writer </span><span class="s2">= </span><span class="s0">new </span><span class="s1">PrintWriter</span><span class="s2">(</span><span class="s0">new </span><span class="s1">FileWriter</span><span class="s2">(</span><span class="s1">filePath</span><span class="s2">))) {</span>
            <span class="s1">writer</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;SALES REPORT (&quot; </span><span class="s2">+ </span><span class="s1">startDate </span><span class="s2">+ </span><span class="s3">&quot; to &quot; </span><span class="s2">+ </span><span class="s1">endDate </span><span class="s2">+ </span><span class="s3">&quot;)&quot;</span><span class="s2">);</span>
            <span class="s1">writer</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;%-20s %-15s %-10s %-10s%n&quot;</span><span class="s2">, </span><span class="s3">&quot;Item&quot;</span><span class="s2">, </span><span class="s3">&quot;Category&quot;</span><span class="s2">, </span><span class="s3">&quot;Quantity&quot;</span><span class="s2">, </span><span class="s3">&quot;Total Sales&quot;</span><span class="s2">);</span>

            <span class="s5">// Reset the ResultSet cursor to beginning</span>
            <span class="s1">rs</span><span class="s2">.</span><span class="s1">beforeFirst</span><span class="s2">();</span>
            <span class="s0">while </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s1">writer</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;%-20s %-15s %-10d %-9.2f%n&quot;</span><span class="s2">,</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Name&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Category&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;TotalQty&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getDouble</span><span class="s2">(</span><span class="s3">&quot;TotalSales&quot;</span><span class="s2">));</span>
            <span class="s2">}</span>

            <span class="s1">writer</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;-----------------------------------------&quot;</span><span class="s2">);</span>
            <span class="s1">writer</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;Total Days: %d%n&quot;</span><span class="s2">, </span><span class="s1">daysBetween</span><span class="s2">);</span>
            <span class="s1">writer</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;GRAND TOTAL: %.2f%n&quot;</span><span class="s2">, </span><span class="s1">grandTotal</span><span class="s2">);</span>

            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Report saved to: &quot; </span><span class="s2">+ </span><span class="s1">filePath</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">IOException e</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Error saving report: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getMessage</span><span class="s2">());</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">viewPopularItems</span><span class="s2">() {</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- MOST POPULAR ITEMS ---&quot;</span><span class="s2">);</span>
        <span class="s1">menuMap</span><span class="s2">.</span><span class="s1">values</span><span class="s2">().</span><span class="s1">stream</span><span class="s2">()</span>
                <span class="s2">.</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">Comparator</span><span class="s2">.</span><span class="s1">comparingInt</span><span class="s2">((</span><span class="s1">MenuItem item</span><span class="s2">) </span><span class="s1">-&gt; item</span><span class="s2">.</span><span class="s1">popularity</span><span class="s2">).</span><span class="s1">reversed</span><span class="s2">())</span>
                <span class="s2">.</span><span class="s1">limit</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)</span>
                <span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s1">System</span><span class="s2">.</span><span class="s1">out::println</span><span class="s2">);</span>
    <span class="s2">}</span>



    <span class="s0">static void </span><span class="s1">specialOffers</span><span class="s2">() {</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- SPECIAL OFFERS MANAGEMENT ---&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;1. Add Happy Hour Discount&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;2. Add Category Discount&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;3. View Current Offers&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;4. Back&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Choice: &quot;</span><span class="s2">);</span>
        <span class="s0">int </span><span class="s1">choice</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">choice </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">choice </span><span class="s2">&gt;= </span><span class="s4">1 </span><span class="s2">&amp;&amp; </span><span class="s1">choice </span><span class="s2">&lt;=</span><span class="s4">4</span><span class="s2">) {</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Please enter a number between 1 and 4: &quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a number between 1 and 4: &quot;</span><span class="s2">);</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">switch </span><span class="s2">(</span><span class="s1">choice</span><span class="s2">) {</span>
            <span class="s0">case </span><span class="s4">1</span><span class="s2">: </span><span class="s5">// Happy Hour</span>
                <span class="s1">HappyHourOffer hhOffer </span><span class="s2">= </span><span class="s0">new </span><span class="s1">HappyHourOffer</span><span class="s2">();</span>
                <span class="s1">hhOffer</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s3">&quot;HAPPY_HOUR&quot;</span><span class="s2">;</span>

                <span class="s5">// Discount percentage validation</span>
                <span class="s0">int </span><span class="s1">discountPercent</span><span class="s2">;</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter discount percentage (0-100): &quot;</span><span class="s2">);</span>
                    <span class="s1">String input </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s1">discountPercent </span><span class="s2">= </span><span class="s1">Integer</span><span class="s2">.</span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">input</span><span class="s2">);</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">discountPercent </span><span class="s2">&gt;= </span><span class="s4">0 </span><span class="s2">&amp;&amp; </span><span class="s1">discountPercent </span><span class="s2">&lt;= </span><span class="s4">100</span><span class="s2">) {</span>
                            <span class="s0">break</span><span class="s2">;</span>
                        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a value between 0 and 100.&quot;</span><span class="s2">);</span>
                        <span class="s2">}</span>
                    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">NumberFormatException e</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a numeric value.&quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s1">hhOffer</span><span class="s2">.</span><span class="s1">discountPercent </span><span class="s2">= </span><span class="s1">discountPercent</span><span class="s2">;</span>

                <span class="s5">// Start time validation</span>
                <span class="s1">LocalTime startTime</span><span class="s2">;</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter start time (HH:mm): &quot;</span><span class="s2">);</span>
                    <span class="s1">String timeInput </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s1">startTime </span><span class="s2">= </span><span class="s1">LocalTime</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">timeInput</span><span class="s2">);</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">DateTimeParseException e</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid time format. Please use HH:mm (e.g., 14:30).&quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s1">hhOffer</span><span class="s2">.</span><span class="s1">startTime </span><span class="s2">= </span><span class="s1">startTime</span><span class="s2">;</span>

                <span class="s5">// End time validation</span>
                <span class="s1">LocalTime endTime</span><span class="s2">;</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter end time (HH:mm): &quot;</span><span class="s2">);</span>
                    <span class="s1">String timeInput </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s1">endTime </span><span class="s2">= </span><span class="s1">LocalTime</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">timeInput</span><span class="s2">);</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">endTime</span><span class="s2">.</span><span class="s1">isAfter</span><span class="s2">(</span><span class="s1">startTime</span><span class="s2">)) {</span>
                            <span class="s0">break</span><span class="s2">;</span>
                        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;End time must be after start time.&quot;</span><span class="s2">);</span>
                        <span class="s2">}</span>
                    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">DateTimeParseException e</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid time format. Please use HH:mm (e.g., 15:30).&quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s1">hhOffer</span><span class="s2">.</span><span class="s1">endTime </span><span class="s2">= </span><span class="s1">endTime</span><span class="s2">;</span>

                <span class="s5">// Days validation</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter days (comma separated, e.g., MONDAY,TUESDAY): &quot;</span><span class="s2">);</span>
                <span class="s1">String</span><span class="s2">[] </span><span class="s1">dayInput </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">toUpperCase</span><span class="s2">().</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;,&quot;</span><span class="s2">);</span>
                <span class="s1">hhOffer</span><span class="s2">.</span><span class="s1">days </span><span class="s2">= </span><span class="s0">new </span><span class="s1">DataStructures</span><span class="s2">.</span><span class="s1">CustomHashSet</span><span class="s2">&lt;&gt;();</span>
                <span class="s0">boolean </span><span class="s1">daysValid </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s0">for </span><span class="s2">(</span><span class="s1">String day </span><span class="s2">: </span><span class="s1">dayInput</span><span class="s2">) {</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s1">hhOffer</span><span class="s2">.</span><span class="s1">days</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">DayOfWeek</span><span class="s2">.</span><span class="s1">valueOf</span><span class="s2">(</span><span class="s1">day</span><span class="s2">.</span><span class="s1">trim</span><span class="s2">()));</span>
                    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">IllegalArgumentException e</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid day: '&quot; </span><span class="s2">+ </span><span class="s1">day</span><span class="s2">.</span><span class="s1">trim</span><span class="s2">() + </span><span class="s3">&quot;'. Please enter valid day names.&quot;</span><span class="s2">);</span>
                        <span class="s1">daysValid </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s0">if </span><span class="s2">(!</span><span class="s1">daysValid</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Happy hour offer not added due to invalid day input.&quot;</span><span class="s2">);</span>
                    <span class="s0">break</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s1">happyHourOffers</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">hhOffer</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Happy hour offer added!&quot;</span><span class="s2">);</span>
                <span class="s0">break</span><span class="s2">;</span>

            <span class="s0">case </span><span class="s4">2</span><span class="s2">: </span><span class="s5">// Category Discount</span>
                <span class="s1">CategoryOffer catOffer </span><span class="s2">= </span><span class="s0">new </span><span class="s1">CategoryOffer</span><span class="s2">();</span>
                <span class="s1">catOffer</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s3">&quot;CATEGORY&quot;</span><span class="s2">;</span>

                <span class="s1">String cat</span><span class="s2">;</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter category: &quot;</span><span class="s2">);</span>
                    <span class="s1">cat </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">();</span>
                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">cat</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) </span><span class="s0">break</span><span class="s2">;</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Category cannot be empty.&quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s1">catOffer</span><span class="s2">.</span><span class="s1">category </span><span class="s2">= </span><span class="s1">cat</span><span class="s2">;</span>

                <span class="s5">// Discount percentage validation</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Enter discount percentage (0-100): &quot;</span><span class="s2">);</span>
                    <span class="s1">String input </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">();</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s1">discountPercent </span><span class="s2">= </span><span class="s1">Integer</span><span class="s2">.</span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">input</span><span class="s2">);</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">discountPercent </span><span class="s2">&gt;= </span><span class="s4">0 </span><span class="s2">&amp;&amp; </span><span class="s1">discountPercent </span><span class="s2">&lt;= </span><span class="s4">100</span><span class="s2">) {</span>
                            <span class="s0">break</span><span class="s2">;</span>
                        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a value between 0 and 100.&quot;</span><span class="s2">);</span>
                        <span class="s2">}</span>
                    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">NumberFormatException e</span><span class="s2">) {</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Invalid input. Please enter a numeric value.&quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s1">catOffer</span><span class="s2">.</span><span class="s1">discountPercent </span><span class="s2">= </span><span class="s1">discountPercent</span><span class="s2">;</span>

                <span class="s1">categoryOffers</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">catOffer</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Category offer added!&quot;</span><span class="s2">);</span>
                <span class="s0">break</span><span class="s2">;</span>


            <span class="s0">case </span><span class="s4">3</span><span class="s2">:</span>
                <span class="s1">viewCurrentOffers</span><span class="s2">();</span>
                <span class="s0">break</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">viewCurrentOffers</span><span class="s2">() {</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- CURRENT ACTIVE OFFERS ---&quot;</span><span class="s2">);</span>

        <span class="s5">// Happy Hour Offers</span>
        <span class="s0">if </span><span class="s2">(!</span><span class="s1">happyHourOffers</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Happy Hour Discounts:&quot;</span><span class="s2">);</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s1">HappyHourOffer offer </span><span class="s2">: </span><span class="s1">happyHourOffers</span><span class="s2">) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">offer</span><span class="s2">.</span><span class="s1">isActive</span><span class="s2">) {</span>
                    <span class="s1">String days </span><span class="s2">= </span><span class="s1">offer</span><span class="s2">.</span><span class="s1">days</span><span class="s2">.</span><span class="s1">stream</span><span class="s2">()</span>
                            <span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">d -&gt; d</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">().</span><span class="s1">substring</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">))</span>
                            <span class="s2">.</span><span class="s1">collect</span><span class="s2">(</span><span class="s1">Collectors</span><span class="s2">.</span><span class="s1">joining</span><span class="s2">(</span><span class="s3">&quot;, &quot;</span><span class="s2">));</span>

                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;- %d%% off (%s to %s on %s)</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">,</span>
                            <span class="s1">offer</span><span class="s2">.</span><span class="s1">discountPercent</span><span class="s2">,</span>
                            <span class="s1">offer</span><span class="s2">.</span><span class="s1">startTime</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">DateTimeFormatter</span><span class="s2">.</span><span class="s1">ofPattern</span><span class="s2">(</span><span class="s3">&quot;HH:mm&quot;</span><span class="s2">)),</span>
                            <span class="s1">offer</span><span class="s2">.</span><span class="s1">endTime</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">DateTimeFormatter</span><span class="s2">.</span><span class="s1">ofPattern</span><span class="s2">(</span><span class="s3">&quot;HH:mm&quot;</span><span class="s2">)),</span>
                            <span class="s1">days</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s5">// Category Offers</span>
        <span class="s0">if </span><span class="s2">(!</span><span class="s1">categoryOffers</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Category Discounts:&quot;</span><span class="s2">);</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s1">CategoryOffer offer </span><span class="s2">: </span><span class="s1">categoryOffers</span><span class="s2">) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">offer</span><span class="s2">.</span><span class="s1">isActive</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;- %d%% off on %s</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">,</span>
                            <span class="s1">offer</span><span class="s2">.</span><span class="s1">discountPercent</span><span class="s2">,</span>
                            <span class="s1">offer</span><span class="s2">.</span><span class="s1">category</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>


        <span class="s0">if </span><span class="s2">(</span><span class="s1">happyHourOffers</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">() &amp;&amp; </span><span class="s1">categoryOffers</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;No active offers currently.&quot;</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">static void </span><span class="s1">loyaltyProgramReport</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- LOYALTY PROGRAM REPORT ---&quot;</span><span class="s2">);</span>
        <span class="s1">String sql </span><span class="s2">= </span><span class="s3">&quot;SELECT Username, Points, LastVisit FROM loyalty_program ORDER BY Points DESC LIMIT 10&quot;</span><span class="s2">;</span>

        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">sql</span><span class="s2">)) {</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">ps</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;%-20s %-10s %-15s</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s3">&quot;Customer&quot;</span><span class="s2">, </span><span class="s3">&quot;Points&quot;</span><span class="s2">, </span><span class="s3">&quot;Last Visit&quot;</span><span class="s2">);</span>
            <span class="s0">while </span><span class="s2">(</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;%-20s %-10d %-15s</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">,</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Username&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Points&quot;</span><span class="s2">),</span>
                        <span class="s1">rs</span><span class="s2">.</span><span class="s1">getDate</span><span class="s2">(</span><span class="s3">&quot;LastVisit&quot;</span><span class="s2">));</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>


    <span class="s0">static void </span><span class="s1">updatePointsInDatabase</span><span class="s2">(</span><span class="s1">String username</span><span class="s2">, </span><span class="s0">int </span><span class="s1">newPoints</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">String updateSql </span><span class="s2">= </span><span class="s3">&quot;UPDATE loyalty_program SET Points = ? WHERE Username = ?&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement ps </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">updateSql</span><span class="s2">)) {</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">newPoints</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">setString</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">username</span><span class="s2">);</span>
            <span class="s1">ps</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">generateBill</span><span class="s2">(</span><span class="s0">int </span><span class="s1">itemId</span><span class="s2">, </span><span class="s0">int </span><span class="s1">quantity</span><span class="s2">, </span><span class="s1">String username</span><span class="s2">, </span><span class="s1">List</span><span class="s2">&lt;</span><span class="s1">String</span><span class="s2">&gt; </span><span class="s1">freeItems</span><span class="s2">) </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">itemId </span><span class="s2">== </span><span class="s4">0 </span><span class="s2">&amp;&amp; </span><span class="s1">freeItems</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;No items in order!&quot;</span><span class="s2">);</span>
            <span class="s0">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">double </span><span class="s1">basePrice </span><span class="s2">= </span><span class="s4">0</span><span class="s2">;</span>
        <span class="s1">MenuItem item </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>

        <span class="s0">if </span><span class="s2">(</span><span class="s1">itemId </span><span class="s2">!= </span><span class="s4">0</span><span class="s2">) {</span>
            <span class="s1">item </span><span class="s2">= </span><span class="s1">menuMap</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">);</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">item </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Item not found!&quot;</span><span class="s2">);</span>
                <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">basePrice </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">price </span><span class="s2">* </span><span class="s1">quantity</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">double </span><span class="s1">happyHourDiscount </span><span class="s2">= </span><span class="s1">calculateHappyHourDiscount</span><span class="s2">(</span><span class="s1">basePrice</span><span class="s2">);</span>
        <span class="s0">double </span><span class="s1">categoryDiscount </span><span class="s2">= </span><span class="s1">calculateCategoryDiscount</span><span class="s2">(</span><span class="s1">item </span><span class="s2">!= </span><span class="s0">null </span><span class="s2">? </span><span class="s1">item</span><span class="s2">.</span><span class="s1">category </span><span class="s2">: </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s1">basePrice</span><span class="s2">);</span>

        <span class="s0">double </span><span class="s1">loyaltyDiscount </span><span class="s2">= </span><span class="s1">calculateLoyaltyDiscount</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s1">basePrice</span><span class="s2">);</span>
        <span class="s0">double </span><span class="s1">totalDiscount </span><span class="s2">= </span><span class="s1">happyHourDiscount </span><span class="s2">+ </span><span class="s1">categoryDiscount  </span><span class="s2">+ </span><span class="s1">loyaltyDiscount</span><span class="s2">;</span>
        <span class="s0">double </span><span class="s1">finalPrice </span><span class="s2">= </span><span class="s1">basePrice </span><span class="s2">- </span><span class="s1">totalDiscount</span><span class="s2">;</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">--- ORDER BILL ---&quot;</span><span class="s2">);</span>

        <span class="s0">if </span><span class="s2">(</span><span class="s1">item </span><span class="s2">!= </span><span class="s0">null</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;Item: %s (Qty: %d)</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">item</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s1">quantity</span><span class="s2">);</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;Base Price: %.2f</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">basePrice</span><span class="s2">);</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">happyHourDiscount </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">)</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;Happy Hour Discount (-%.2f)</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">happyHourDiscount</span><span class="s2">);</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">categoryDiscount </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">)</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;Category Discount (-%.2f)</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">categoryDiscount</span><span class="s2">);</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">loyaltyDiscount </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">)</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;Loyalty Discount (-%.2f)</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">loyaltyDiscount</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">if </span><span class="s2">(!</span><span class="s1">freeItems</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Free Items Included:&quot;</span><span class="s2">);</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s1">String freeItem </span><span class="s2">: </span><span class="s1">freeItems</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;- &quot; </span><span class="s2">+ </span><span class="s1">freeItem</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;-------------------&quot;</span><span class="s2">);</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;TOTAL: %.2f</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">finalPrice</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s5">// Discount calculation methods</span>
    <span class="s0">static double </span><span class="s1">calculateHappyHourDiscount</span><span class="s2">(</span><span class="s0">double </span><span class="s1">basePrice</span><span class="s2">) {</span>
        <span class="s1">LocalTime now </span><span class="s2">= </span><span class="s1">LocalTime</span><span class="s2">.</span><span class="s1">now</span><span class="s2">();</span>
        <span class="s1">DayOfWeek today </span><span class="s2">= </span><span class="s1">LocalDate</span><span class="s2">.</span><span class="s1">now</span><span class="s2">().</span><span class="s1">getDayOfWeek</span><span class="s2">();</span>

        <span class="s0">for </span><span class="s2">(</span><span class="s1">HappyHourOffer offer </span><span class="s2">: </span><span class="s1">happyHourOffers</span><span class="s2">) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">offer</span><span class="s2">.</span><span class="s1">isActive </span><span class="s2">&amp;&amp;</span>
                    <span class="s1">offer</span><span class="s2">.</span><span class="s1">days</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span><span class="s1">today</span><span class="s2">) &amp;&amp;</span>
                    <span class="s2">!</span><span class="s1">now</span><span class="s2">.</span><span class="s1">isBefore</span><span class="s2">(</span><span class="s1">offer</span><span class="s2">.</span><span class="s1">startTime</span><span class="s2">) &amp;&amp;</span>
                    <span class="s2">!</span><span class="s1">now</span><span class="s2">.</span><span class="s1">isAfter</span><span class="s2">(</span><span class="s1">offer</span><span class="s2">.</span><span class="s1">endTime</span><span class="s2">)) {</span>
                <span class="s0">return </span><span class="s1">basePrice </span><span class="s2">* (</span><span class="s1">offer</span><span class="s2">.</span><span class="s1">discountPercent </span><span class="s2">/ </span><span class="s4">100.0</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s0">return </span><span class="s4">0</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">static double </span><span class="s1">calculateCategoryDiscount</span><span class="s2">(</span><span class="s1">String category</span><span class="s2">, </span><span class="s0">double </span><span class="s1">basePrice</span><span class="s2">) {</span>
        <span class="s0">for </span><span class="s2">(</span><span class="s1">CategoryOffer offer </span><span class="s2">: </span><span class="s1">categoryOffers</span><span class="s2">) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">offer</span><span class="s2">.</span><span class="s1">isActive </span><span class="s2">&amp;&amp; </span><span class="s1">offer</span><span class="s2">.</span><span class="s1">category</span><span class="s2">.</span><span class="s1">equalsIgnoreCase</span><span class="s2">(</span><span class="s1">category</span><span class="s2">)) {</span>
                <span class="s0">return </span><span class="s1">basePrice </span><span class="s2">* (</span><span class="s1">offer</span><span class="s2">.</span><span class="s1">discountPercent </span><span class="s2">/ </span><span class="s4">100.0</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s0">return </span><span class="s4">0</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">markOrderCompleted</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">viewPendingOrders</span><span class="s2">();</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Enter OrderID to mark as completed: &quot;</span><span class="s2">);</span>
        <span class="s0">int </span><span class="s1">orderId</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">orderId </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input! Please enter a numeric ID: &quot;</span><span class="s2">);</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Entered OrderID: &quot; </span><span class="s2">+ </span><span class="s1">orderId</span><span class="s2">);</span>

        <span class="s1">String checkSql </span><span class="s2">= </span><span class="s3">&quot;SELECT * FROM orders WHERE OrderID = ? AND Status = 'PENDING'&quot;</span><span class="s2">;</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement checkPs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">checkSql</span><span class="s2">)) {</span>
            <span class="s1">checkPs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">orderId</span><span class="s2">);</span>
            <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">checkPs</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Order not found or already completed/cancelled!&quot;</span><span class="s2">);</span>
                <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Order found, processing...&quot;</span><span class="s2">);</span>

            <span class="s1">String username </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Username&quot;</span><span class="s2">);</span>
            <span class="s0">int </span><span class="s1">quantity </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Quantity&quot;</span><span class="s2">);</span>
            <span class="s0">int </span><span class="s1">itemId </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;ItemID&quot;</span><span class="s2">);</span>

            <span class="s1">MenuItem item </span><span class="s2">= </span><span class="s1">menuMap</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">);</span>
            <span class="s0">double </span><span class="s1">orderValue </span><span class="s2">= </span><span class="s1">item </span><span class="s2">!= </span><span class="s0">null </span><span class="s2">? </span><span class="s1">item</span><span class="s2">.</span><span class="s1">price </span><span class="s2">* </span><span class="s1">quantity </span><span class="s2">: </span><span class="s4">0</span><span class="s2">;</span>
            <span class="s0">int </span><span class="s1">pointsEarned </span><span class="s2">= </span><span class="s1">calculateLoyaltyPoints</span><span class="s2">(</span><span class="s1">orderValue</span><span class="s2">);</span>

            <span class="s1">String updateSql </span><span class="s2">= </span><span class="s3">&quot;UPDATE orders SET Status = 'COMPLETED' WHERE OrderID = ?&quot;</span><span class="s2">;</span>
            <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement updatePs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">updateSql</span><span class="s2">)) {</span>
                <span class="s1">updatePs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">orderId</span><span class="s2">);</span>
                <span class="s0">int </span><span class="s1">rows </span><span class="s2">= </span><span class="s1">updatePs</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">rows </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Order #&quot; </span><span class="s2">+ </span><span class="s1">orderId </span><span class="s2">+ </span><span class="s3">&quot; marked as completed!&quot;</span><span class="s2">);</span>

                    <span class="s0">if </span><span class="s2">(</span><span class="s1">item </span><span class="s2">!= </span><span class="s0">null</span><span class="s2">) {</span>
                        <span class="s1">item</span><span class="s2">.</span><span class="s1">popularity </span><span class="s2">+= </span><span class="s1">quantity</span><span class="s2">;</span>
                        <span class="s1">String updatePop </span><span class="s2">= </span><span class="s3">&quot;UPDATE menu_items SET Popularity = ? WHERE ID = ?&quot;</span><span class="s2">;</span>
                        <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement popPs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">updatePop</span><span class="s2">)) {</span>
                            <span class="s1">popPs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">item</span><span class="s2">.</span><span class="s1">popularity</span><span class="s2">);</span>
                            <span class="s1">popPs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">itemId</span><span class="s2">);</span>
                            <span class="s1">popPs</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
                        <span class="s2">}</span>
                    <span class="s2">}</span>

                    <span class="s1">updateLoyaltyPoints</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, </span><span class="s1">pointsEarned</span><span class="s2">);</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Added &quot; </span><span class="s2">+ </span><span class="s1">pointsEarned </span><span class="s2">+ </span><span class="s3">&quot; loyalty points to &quot; </span><span class="s2">+ </span><span class="s1">username </span><span class="s2">+ </span><span class="s3">&quot; (order value: Rs.&quot; </span><span class="s2">+ </span><span class="s1">orderValue </span><span class="s2">+ </span><span class="s3">&quot;)&quot;</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Failed to update order status.&quot;</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">cancelOrder</span><span class="s2">() </span><span class="s0">throws </span><span class="s1">SQLException </span><span class="s2">{</span>
        <span class="s1">viewPendingOrders</span><span class="s2">();</span>

        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Enter OrderID to cancel: &quot;</span><span class="s2">);</span>
        <span class="s0">int </span><span class="s1">orderId</span><span class="s2">;</span>
        <span class="s0">while </span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s1">orderId </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextInt</span><span class="s2">();</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// consume newline</span>
                <span class="s0">break</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">InputMismatchException e</span><span class="s2">) {</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Invalid input! Please enter a numeric ID: &quot;</span><span class="s2">);</span>
                <span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">(); </span><span class="s5">// clear invalid input</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">try </span><span class="s2">{</span>
            <span class="s1">String checkSql </span><span class="s2">= </span><span class="s3">&quot;SELECT * FROM orders WHERE OrderID = ? AND Status = 'PENDING'&quot;</span><span class="s2">;</span>
            <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement checkPs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">checkSql</span><span class="s2">)) {</span>
                <span class="s1">checkPs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">orderId</span><span class="s2">);</span>
                <span class="s1">ResultSet rs </span><span class="s2">= </span><span class="s1">checkPs</span><span class="s2">.</span><span class="s1">executeQuery</span><span class="s2">();</span>

                <span class="s0">if </span><span class="s2">(!</span><span class="s1">rs</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Error: Order not found or not in PENDING status!&quot;</span><span class="s2">);</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Only pending orders can be cancelled.&quot;</span><span class="s2">);</span>
                    <span class="s0">return</span><span class="s2">;</span>
                <span class="s2">}</span>

                <span class="s1">String username </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">(</span><span class="s3">&quot;Username&quot;</span><span class="s2">);</span>
                <span class="s0">int </span><span class="s1">itemId </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;ItemID&quot;</span><span class="s2">);</span>
                <span class="s0">int </span><span class="s1">quantity </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s3">&quot;Quantity&quot;</span><span class="s2">);</span>

                <span class="s5">// Calculate order value for loyalty points</span>
                <span class="s1">MenuItem item </span><span class="s2">= </span><span class="s1">menuMap</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">itemId</span><span class="s2">);</span>
                <span class="s0">double </span><span class="s1">orderValue </span><span class="s2">= </span><span class="s1">item </span><span class="s2">!= </span><span class="s0">null </span><span class="s2">? </span><span class="s1">item</span><span class="s2">.</span><span class="s1">price </span><span class="s2">* </span><span class="s1">quantity </span><span class="s2">: </span><span class="s4">0</span><span class="s2">;</span>
                <span class="s0">int </span><span class="s1">pointsToRemove </span><span class="s2">= </span><span class="s1">calculateLoyaltyPoints</span><span class="s2">(</span><span class="s1">orderValue</span><span class="s2">);</span>

                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Order Details:&quot;</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Customer: &quot; </span><span class="s2">+ </span><span class="s1">username</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Item ID: &quot; </span><span class="s2">+ </span><span class="s1">itemId</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Quantity: &quot; </span><span class="s2">+ </span><span class="s1">quantity</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Order Value: Rs.&quot; </span><span class="s2">+ </span><span class="s1">orderValue</span><span class="s2">);</span>
                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Points to remove: &quot; </span><span class="s2">+ </span><span class="s1">pointsToRemove</span><span class="s2">);</span>

                <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Are you sure you want to cancel this order? (yes/no): &quot;</span><span class="s2">);</span>
                <span class="s1">String confirmation </span><span class="s2">= </span><span class="s1">scanner</span><span class="s2">.</span><span class="s1">nextLine</span><span class="s2">().</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">toLowerCase</span><span class="s2">();</span>
                <span class="s0">if </span><span class="s2">(!</span><span class="s1">confirmation</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s3">&quot;yes&quot;</span><span class="s2">)) {</span>
                    <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Order cancellation aborted.&quot;</span><span class="s2">);</span>
                    <span class="s0">return</span><span class="s2">;</span>
                <span class="s2">}</span>

                <span class="s1">String updateSql </span><span class="s2">= </span><span class="s3">&quot;UPDATE orders SET Status = 'CANCELLED' WHERE OrderID = ?&quot;</span><span class="s2">;</span>
                <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement updatePs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">updateSql</span><span class="s2">)) {</span>
                    <span class="s1">updatePs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">orderId</span><span class="s2">);</span>
                    <span class="s0">int </span><span class="s1">rows </span><span class="s2">= </span><span class="s1">updatePs</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>

                    <span class="s0">if </span><span class="s2">(</span><span class="s1">rows </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">) {</span>
                        <span class="s1">con</span><span class="s2">.</span><span class="s1">commit</span><span class="s2">();</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Order #&quot; </span><span class="s2">+ </span><span class="s1">orderId </span><span class="s2">+ </span><span class="s3">&quot; successfully cancelled!&quot;</span><span class="s2">);</span>

                        <span class="s0">if </span><span class="s2">(</span><span class="s1">item </span><span class="s2">!= </span><span class="s0">null</span><span class="s2">) {</span>
                            <span class="s1">item</span><span class="s2">.</span><span class="s1">popularity </span><span class="s2">-= </span><span class="s1">quantity</span><span class="s2">;</span>
                            <span class="s1">String updatePop </span><span class="s2">= </span><span class="s3">&quot;UPDATE menu_items SET Popularity = ? WHERE ID = ?&quot;</span><span class="s2">;</span>
                            <span class="s0">try </span><span class="s2">(</span><span class="s1">PreparedStatement popPs </span><span class="s2">= </span><span class="s1">con</span><span class="s2">.</span><span class="s1">prepareStatement</span><span class="s2">(</span><span class="s1">updatePop</span><span class="s2">)) {</span>
                                <span class="s1">popPs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">item</span><span class="s2">.</span><span class="s1">popularity</span><span class="s2">);</span>
                                <span class="s1">popPs</span><span class="s2">.</span><span class="s1">setInt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">itemId</span><span class="s2">);</span>
                                <span class="s1">popPs</span><span class="s2">.</span><span class="s1">executeUpdate</span><span class="s2">();</span>
                            <span class="s2">}</span>
                        <span class="s2">}</span>

                        <span class="s1">updateLoyaltyPoints</span><span class="s2">(</span><span class="s1">username</span><span class="s2">, -</span><span class="s1">pointsToRemove</span><span class="s2">);</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Removed &quot; </span><span class="s2">+ </span><span class="s1">pointsToRemove </span><span class="s2">+ </span><span class="s3">&quot; loyalty points from &quot; </span><span class="s2">+ </span><span class="s1">username</span><span class="s2">);</span>
                    <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">System</span><span class="s2">.</span><span class="s1">out</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Failed to cancel order!&quot;</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">SQLException e</span><span class="s2">) {</span>
            <span class="s1">con</span><span class="s2">.</span><span class="s1">rollback</span><span class="s2">();</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">err</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Error cancelling order: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getMessage</span><span class="s2">());</span>
            <span class="s0">throw </span><span class="s1">e</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">static void </span><span class="s1">logOrderToFile</span><span class="s2">(</span><span class="s0">int </span><span class="s1">itemId</span><span class="s2">, </span><span class="s0">int </span><span class="s1">quantity</span><span class="s2">, </span><span class="s1">String username</span><span class="s2">, </span><span class="s1">List</span><span class="s2">&lt;</span><span class="s1">String</span><span class="s2">&gt; </span><span class="s1">freeItems</span><span class="s2">) {</span>
        <span class="s0">try </span><span class="s2">(</span><span class="s1">BufferedWriter writer </span><span class="s2">= </span><span class="s0">new </span><span class="s1">BufferedWriter</span><span class="s2">(</span><span class="s0">new </span><span class="s1">FileWriter</span><span class="s2">(</span><span class="s3">&quot;orders.txt&quot;</span><span class="s2">, </span><span class="s0">true</span><span class="s2">))) {</span>
            <span class="s1">writer</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">String</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">&quot;[%s] User: %s, ItemID: %d, Quantity: %d&quot;</span><span class="s2">,</span>
                    <span class="s1">LocalDateTime</span><span class="s2">.</span><span class="s1">now</span><span class="s2">().</span><span class="s1">format</span><span class="s2">(</span><span class="s1">DateTimeFormatter</span><span class="s2">.</span><span class="s1">ISO_LOCAL_DATE_TIME</span><span class="s2">),</span>
                    <span class="s1">username</span><span class="s2">, </span><span class="s1">itemId</span><span class="s2">, </span><span class="s1">quantity</span><span class="s2">));</span>

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">freeItems</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
                <span class="s1">writer</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;, Free Items: &quot; </span><span class="s2">+ </span><span class="s1">String</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot;, &quot;</span><span class="s2">, </span><span class="s1">freeItems</span><span class="s2">));</span>
            <span class="s2">}</span>
            <span class="s1">writer</span><span class="s2">.</span><span class="s1">newLine</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">IOException e</span><span class="s2">) {</span>
            <span class="s1">System</span><span class="s2">.</span><span class="s1">err</span><span class="s2">.</span><span class="s1">println</span><span class="s2">(</span><span class="s3">&quot;Error writing to file: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getMessage</span><span class="s2">());</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
<span class="s2">}</span></pre>
</body>
</html>